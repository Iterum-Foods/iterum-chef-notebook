<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iterum R&D Chef Notebook</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Shadows+Into+Light:wght@400&family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/tailwind-output.css">
    <link rel="stylesheet" href="assets/css/iterum-design-system.css">
    <link rel="icon" type="image/x-icon" href="assets/icons/iterum.ico">
    
    <style>
        /* Landing Page Specific Styles */
        .landing-hero {
            background: linear-gradient(135deg, var(--iterum-primary), var(--iterum-secondary));
            color: white;
            padding: var(--spacing-16) var(--spacing-6);
            text-align: center;
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-8);
            position: relative;
            overflow: hidden;
        }
        
        .landing-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .landing-hero h1 {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-4);
            position: relative;
            z-index: 1;
        }
        
        .landing-hero p {
            font-size: var(--font-size-lg);
            opacity: 0.9;
            margin-bottom: var(--spacing-6);
            position: relative;
            z-index: 1;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .hero-cta {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-full);
            text-decoration: none;
            font-weight: var(--font-weight-semibold);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all var(--transition-normal);
            position: relative;
            z-index: 1;
        }
        
                .hero-cta:hover {
          background: rgba(255, 255, 255, 0.3);
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        /* Project Status Display */
        .project-status-display {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-top: 0.5rem;
          font-size: 0.875rem;
        }
        
        .project-status-label {
          color: var(--gray-600);
          font-weight: 500;
        }
        
        .project-status-value {
          color: var(--iterum-primary);
          font-weight: 600;
          padding: 0.25rem 0.5rem;
          background: rgba(99, 102, 241, 0.1);
          border-radius: 0.375rem;
        }
        
        /* Enhanced Modal Animations */
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(-20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes modalPulse {
          0%, 100% { 
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7);
          }
          50% { 
            transform: scale(1.02);
            box-shadow: 0 0 0 20px rgba(251, 191, 36, 0);
          }
        }
        
        @keyframes attentionBounce {
          0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
          40% { transform: translateY(-10px); }
          60% { transform: translateY(-5px); }
        }
        
        .auth-modal-overlay {
          animation: fadeIn 0.5s ease-out;
        }
        
        .auth-modal-overlay > div {
          animation: modalPulse 3s infinite, attentionBounce 2s infinite;
        }
        
        .modal-attention {
          animation: modalPulse 2s infinite !important;
        }
        
        @keyframes flash {
          0%, 50% { opacity: 1; }
          25%, 75% { opacity: 0.5; }
        }
        
        .flash-warning {
          animation: flash 1s infinite;
        }
        
        /* Project Statistics Display */
        .project-stats-display {
          margin-top: 0.5rem;
        }
        
        .project-stats {
          display: flex;
          flex-wrap: wrap;
          gap: 0.5rem;
          font-size: 0.75rem;
        }
        
        .stat-item {
          padding: 0.25rem 0.5rem;
          background: rgba(156, 163, 175, 0.1);
          border-radius: 0.25rem;
          color: var(--gray-700);
          font-weight: 500;
        }
        
        .stat-item.total {
          background: rgba(99, 102, 241, 0.1);
          color: var(--iterum-primary);
          font-weight: 600;
        }
        
        /* Button Styles */
        .btn-secondary {
          background: var(--gray-100);
          color: var(--gray-700);
          border: 1px solid var(--gray-300);
        }
        
        .btn-secondary:hover {
          background: var(--gray-200);
          border-color: var(--gray-400);
        }
        
        /* Feature Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: var(--spacing-6);
            margin-bottom: var(--spacing-8);
        }
        
        .feature-card {
            background: white;
            padding: var(--spacing-6);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            text-align: center;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--iterum-primary), var(--iterum-secondary));
            transform: scaleX(0);
            transition: transform var(--transition-normal);
        }
        
        .feature-card:hover::before {
            transform: scaleX(1);
        }
        
        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        /* Recipe Ideas Notepad Styles */
        .ideas-notepad-section {
          margin: var(--spacing-8) 0;
        }

        .ideas-notepad-header {
          text-align: center;
          margin-bottom: var(--spacing-6);
        }

        .ideas-notepad-header h2 {
          margin-bottom: var(--spacing-2);
        }

        .ideas-notepad-grid {
          display: grid;
          grid-template-columns: 2fr 1fr;
          gap: var(--spacing-6);
          margin-bottom: var(--spacing-6);
        }

        .quick-idea-card,
        .recent-ideas-card {
          background: white;
          border-radius: var(--radius-xl);
          padding: var(--spacing-6);
          box-shadow: var(--shadow-lg);
          border: 1px solid var(--border-color);
        }

        .idea-card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: var(--spacing-4);
          padding-bottom: var(--spacing-3);
          border-bottom: 1px solid var(--border-color);
        }

        .idea-counter {
          font-size: var(--font-size-sm);
          color: var(--gray-600);
          background: var(--gray-100);
          padding: 0.25rem 0.75rem;
          border-radius: var(--radius-full);
        }

        .idea-form {
          display: flex;
          flex-direction: column;
          gap: var(--spacing-4);
        }

        .ideas-list {
          max-height: 300px;
          overflow-y: auto;
        }

        .idea-item {
          padding: var(--spacing-3);
          border: 1px solid var(--border-color);
          border-radius: var(--radius-lg);
          margin-bottom: var(--spacing-2);
          background: var(--gray-50);
          transition: all var(--transition-normal);
        }

        .idea-item:hover {
          background: var(--gray-100);
          transform: translateY(-1px);
        }

        .idea-item-title {
          font-weight: var(--font-weight-semibold);
          color: var(--gray-900);
          margin-bottom: var(--spacing-1);
        }

        .idea-item-description {
          font-size: var(--font-size-sm);
          color: var(--gray-600);
          margin-bottom: var(--spacing-2);
        }

        .idea-item-url {
          margin-bottom: var(--spacing-2);
        }

        .idea-item-url a {
          font-size: var(--font-size-sm);
          color: var(--blue-600);
          text-decoration: none;
          transition: color var(--transition-normal);
        }

        .idea-item-url a:hover {
          color: var(--blue-800);
          text-decoration: underline;
        }

        /* URL Input Group Styles */
        .url-input-group {
          display: flex;
          gap: var(--spacing-2);
          align-items: center;
        }

        .url-input-group .form-input {
          flex: 1;
        }

        .url-input-group .btn {
          white-space: nowrap;
          flex-shrink: 0;
        }

        .url-fetch-status {
          margin-top: var(--spacing-2);
          font-size: var(--font-size-sm);
          min-height: 1.5rem;
        }

        .url-fetch-status.loading {
          color: var(--blue-600);
        }

        .url-fetch-status.success {
          color: var(--green-600);
        }

        .url-fetch-status.error {
          color: var(--red-600);
        }

        .idea-item-meta {
          display: flex;
          gap: var(--spacing-2);
          font-size: var(--font-size-xs);
          color: var(--gray-500);
        }

        .idea-item-actions {
          display: flex;
          gap: var(--spacing-2);
          margin-top: var(--spacing-2);
        }

        .ideas-summary-card {
          background: white;
          border-radius: var(--radius-xl);
          padding: var(--spacing-6);
          box-shadow: var(--shadow-lg);
          border: 1px solid var(--border-color);
        }

        .ideas-summary-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: var(--spacing-4);
          padding-bottom: var(--spacing-3);
          border-bottom: 1px solid var(--border-color);
        }

        .ideas-search {
          display: flex;
          gap: var(--spacing-3);
          margin-bottom: var(--spacing-4);
        }

        .ideas-search input {
          flex: 1;
        }

        @media (max-width: 768px) {
          .ideas-notepad-grid {
            grid-template-columns: 1fr;
          }
        }
        
        .feature-card h3 {
            color: var(--iterum-primary);
            margin-bottom: var(--spacing-3);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
        }
        
        .feature-card p {
            color: var(--gray-600);
            line-height: var(--line-height-relaxed);
        }
        
        .feature-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--iterum-primary), var(--iterum-secondary));
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-2xl);
            margin: 0 auto var(--spacing-4) auto;
            color: white;
        }
        
        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-6);
            margin-bottom: var(--spacing-8);
        }
        
        .dashboard-card {
            background: white;
            padding: var(--spacing-6);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            transition: all var(--transition-normal);
        }
        
        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .dashboard-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-4);
        }
        
        .dashboard-card-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--gray-800);
        }
        
        .dashboard-card-value {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--iterum-primary);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-4);
            margin-bottom: var(--spacing-8);
        }
        
        .stat-item {
            background: white;
            padding: var(--spacing-4);
            border-radius: var(--radius-lg);
            text-align: center;
            border: 1px solid var(--gray-200);
        }
        
        .stat-number {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--iterum-primary);
            margin-bottom: var(--space-2);
        }
        
        .stat-label {
            color: var(--gray-600);
            font-size: var(--font-size-sm);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .landing-hero {
                padding: var(--spacing-12) var(--spacing-4);
            }
            
            .landing-hero h1 {
                font-size: var(--font-size-3xl);
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Simple loading indicator to prevent unresponsive message -->
    <div id="simple-loading" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 9999; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
      <div style="text-align: center;">
        <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
        <p>Loading...</p>
      </div>
    </div>
    
    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
    
    <!-- Authentication will be handled by popup modals instead of loading overlay -->
    <!-- The unified authentication system will show popup modals upon launch -->

    <!-- Reorganized Header for Better Screen Fit -->
    <header class="iterum-header">
      <div class="header-container">
        <!-- Logo Section - Compact -->
        <a href="index.html" class="header-logo">
          <div class="header-logo-icon">
            <span>ğŸƒ</span>
          </div>
          <div class="header-logo-text">
            <div class="header-logo-title">Iterum R&D</div>
            <div class="header-logo-subtitle">Chef Notebook</div>
          </div>
        </a>

        <!-- Center Navigation - Compact with Icons Only on Small Screens -->
        <nav class="header-navigation">
          <a href="index.html" class="header-nav-item active" data-page="index">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">Dashboard</span>
          </a>
          <a href="recipe-library.html" class="header-nav-item" data-page="recipe-library">
            <span class="nav-icon">ğŸ“š</span>
            <span class="nav-text">Library</span>
          </a>
          <a href="recipe-developer.html" class="header-nav-item" data-page="recipe-developer">
            <span class="nav-icon">ğŸ§ª</span>
            <span class="nav-text">Developer</span>
          </a>
          <a href="recipe-upload.html" class="header-nav-item" data-page="recipe-upload">
            <span class="nav-icon">âš¡</span>
            <span class="nav-text">Upload</span>
          </a>
          <a href="menu-builder.html" class="header-nav-item" data-page="menu-builder">
            <span class="nav-icon">ğŸ½ï¸</span>
            <span class="nav-text">Menu</span>
          </a>
          <a href="ingredients.html" class="header-nav-item" data-page="ingredients">
            <span class="nav-icon">ğŸ¥¬</span>
            <span class="nav-text">Ingredients</span>
          </a>
          <a href="equipment-management.html" class="header-nav-item" data-page="equipment-management">
            <span class="nav-icon">ğŸ”§</span>
            <span class="nav-text">Equipment</span>
          </a>
          <a href="vendor-management.html" class="header-nav-item" data-page="vendor-management">
            <span class="nav-icon">ğŸª</span>
            <span class="nav-text">Vendors</span>
          </a>
        </nav>

        <!-- Right Side - Compact User Section -->
        <div class="header-user-section">
          <!-- Compact Project Selector -->
          <div class="header-project-selector-container">
            <div class="project-selector-display" onclick="window.showProjectSelectionDropdown()">
              <div class="project-selector-current">
                <span class="project-selector-icon">ğŸ“‹</span>
                <span class="project-selector-name" data-project-name>Master Project</span>
                <svg class="project-selector-arrow" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </div>
              <div class="project-status-display">
                <span class="project-status-label">Current:</span>
                <span class="project-status-value" data-project-name>Master Project</span>
              </div>
              <div class="project-stats-display" data-project-stats>
                <div class="project-stats">
                  <span class="stat-item">ğŸ¥• 0</span>
                  <span class="stat-item">ğŸ“– 0</span>
                  <span class="stat-item">ğŸ½ï¸ 0</span>
                  <span class="stat-item total">ğŸ“Š 0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Compact Action Buttons -->
          <div class="header-action-buttons">
            <button class="btn btn-secondary btn-sm header-action-btn" onclick="window.projectManager.showImportFromMasterModal()" title="Import from Master" data-import-from-master style="display: none;">
              <span>ğŸ“¥</span>
              <span class="btn-text">Import</span>
            </button>

            <button class="btn btn-primary btn-sm header-action-btn" onclick="window.projectManager.showProjectModal()" title="Manage Projects">
              <span>ğŸ“‹</span>
              <span class="btn-text">Projects</span>
            </button>

            <button class="btn btn-success btn-sm header-action-btn" onclick="showStorageControl()" title="Storage Control">
              <span>ğŸ—‚ï¸</span>
              <span class="btn-text">Storage</span>
            </button>
          </div>

          <!-- User Info Tab - Only visible after authentication -->
          <div class="header-user-tab" onclick="toggleUserDropdown()" id="header-user-tab" style="display: none;">
            <div class="header-user-avatar" id="user-avatar">
              <span id="user-avatar-initial">ğŸ‘¤</span>
            </div>
            <div class="header-user-info">
              <div class="header-user-name" id="current-user">Guest User</div>
              <div class="header-user-role">Chef</div>
            </div>
            <svg class="header-user-dropdown-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>

          <!-- User Dropdown Menu -->
          <div class="header-user-dropdown" id="user-dropdown">
            <div class="header-user-dropdown-header">
              <div class="header-user-dropdown-title" id="dropdown-user-name">Guest User</div>
              <div class="header-user-dropdown-subtitle" id="dropdown-user-role">Chef</div>
            </div>
            
            <div class="header-user-dropdown-menu">
              <div class="header-user-dropdown-item" onclick="window.unifiedAuthSystem?.showUserSelection()">
                <span>ğŸ‘¤</span>
                <span>Edit Profile</span>
              </div>
              <div class="header-user-dropdown-item" onclick="window.unifiedAuthSystem?.createOfflineProfile()">
                <span>â•</span>
                <span>Create Profile</span>
              </div>
            </div>
            
            <div class="header-user-dropdown-divider"></div>
            
            <div class="header-user-dropdown-menu">
              <div class="header-user-dropdown-item" onclick="alert('Settings coming soon!')">
                <span>âš™ï¸</span>
                <span>Settings</span>
              </div>
              <div class="header-user-dropdown-item danger" onclick="window.unifiedAuthSystem?.clearSession()">
                <span>ğŸšª</span>
                <span>Sign Out</span>
              </div>
            </div>
            
            <div class="header-user-dropdown-footer">
              <div class="header-user-dropdown-footer-text">Iterum R&D v1.0</div>
            </div>
          </div>

          <!-- Mobile Navigation Toggle -->
          <button class="header-mobile-toggle" onclick="toggleMobileNav()">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <nav id="mobile-nav" class="header-mobile-nav">
        <!-- Project Selector for Mobile -->
        <div style="margin-bottom: 1rem;">
          <select id="mobile-project-selector" class="header-project-selector" style="width: 100%;">
            <option value="">Select Project...</option>
          </select>
          <div class="project-status-display" style="margin-top: 0.5rem; text-align: center;">
            <span class="project-status-label">Current:</span>
            <span class="project-status-value" data-project-name>Master Project</span>
          </div>
          <div class="project-stats-display" data-project-stats style="margin-top: 0.5rem; text-align: center;">
            <div class="project-stats">
              <span class="stat-item">ğŸ¥• 0 Ingredients</span>
              <span class="stat-item">ğŸ“– 0 Recipes</span>
              <span class="stat-item">ğŸ½ï¸ 0 Menus</span>
              <span class="stat-item total">ğŸ“Š 0 Total Items</span>
            </div>
          </div>
        </div>
        
        <!-- New Project Button for Mobile -->
        <div style="margin-bottom: 1rem;">
          <button class="btn btn-primary w-full" onclick="window.projectManager.showProjectModal()">
            <span>ğŸ“‹</span>
            <span>Manage Projects</span>
          </button>
        </div>

        <!-- Authentication Button - Show if not authenticated -->
        <div style="margin-bottom: 1rem;">
          <button class="btn btn-secondary w-full" onclick="window.unifiedAuthSystem?.showAuthentication()" id="auth-button" style="display: block;">
            <span>ğŸ”</span>
            <span>Sign In / Switch User</span>
          </button>
        </div>

        <!-- Authentication Status -->
        <div id="auth-status" style="margin-bottom: 1rem; padding: 10px; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; text-align: center; font-size: 14px;">
          <span>â³</span>
          <span>Initializing authentication...</span>
        </div>

        <!-- Debug Button -->
        <div style="margin-bottom: 1rem;">
          <button class="btn btn-outline w-full" onclick="debugAuthSystem()" style="font-size: 12px; padding: 8px;">
            <span>ğŸ›</span>
            <span>Debug Auth</span>
          </button>
        </div>

        <!-- Mobile Navigation Items -->
        <a href="index.html" class="header-mobile-nav-item" data-page="index">
          <span class="nav-icon">ğŸ </span>
          <span>Dashboard</span>
        </a>
        <a href="recipe-library.html" class="header-mobile-nav-item" data-page="recipe-library">
          <span class="nav-icon">ğŸ“š</span>
          <span>Library</span>
        </a>
        <a href="recipe-developer.html" class="header-mobile-nav-item" data-page="recipe-developer">
          <span class="nav-icon">ğŸ§ª</span>
          <span>Developer</span>
        </a>
        <a href="recipe-upload.html" class="header-mobile-nav-item" data-page="recipe-upload">
          <span class="nav-icon">âš¡</span>
          <span>Upload</span>
        </a>
        <a href="menu-builder.html" class="header-mobile-nav-item" data-page="menu-builder">
          <span class="nav-icon">ğŸ½ï¸</span>
          <span>Menu</span>
        </a>
        <a href="ingredients.html" class="header-mobile-nav-item" data-page="ingredients">
          <span class="nav-icon">ğŸ¥¬</span>
          <span>Ingredients</span>
        </a>
        <a href="equipment-management.html" class="header-mobile-nav-item" data-page="equipment-management">
          <span class="nav-icon">ğŸ”§</span>
          <span>Equipment</span>
        </a>
        <a href="vendor-management.html" class="header-mobile-nav-item" data-page="vendor-management">
          <span class="nav-icon">ğŸª</span>
          <span>Vendors</span>
        </a>
      </nav>
    </header>

    <!-- Main Content -->
    <main>
      <div class="container">
        <!-- Hero Section -->
        <section class="landing-hero">
          <h1>Welcome to Iterum R&D Chef Notebook</h1>
          <p>Your professional companion for recipe development, ingredient management, and culinary innovation. Built for chefs, food scientists, and culinary professionals.</p>
          <a href="#features" class="hero-cta">
            Explore Features
            <span>â†’</span>
          </a>
          
          <!-- Test User System Buttons -->
          <div style="margin-top: 20px;">
            <button onclick="testUserSystemOnIndex()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 10px 20px; border-radius: 20px; cursor: pointer; margin: 5px;">
              ğŸ§ª Test User System
            </button>
            <!-- Switch User button removed - now available as dropdown in header -->
                           <button onclick="testProjectSystemOnIndex()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 10px 20px; border-radius: 20px; cursor: pointer; margin: 5px;">
                 ğŸ“‹ Test Project System
               </button>
               <button onclick="testDataTaggingSystemOnIndex()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 10px 20px; border-radius: 20px; cursor: pointer; margin: 5px;">
                 ğŸ·ï¸ Test Data Tagging
               </button>
          </div>
        </section>

        <!-- Quick Stats -->
        <section class="stats-grid">
          <div class="stat-item">
            <div class="stat-number" id="total-recipes">0</div>
            <div class="stat-label">Total Recipes</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="total-ingredients">0</div>
            <div class="stat-label">Ingredients</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="active-projects">0</div>
            <div class="stat-label">Active Projects</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="total-menus">0</div>
            <div class="stat-label">Menu Items</div>
          </div>
        </section>

        <!-- Features Grid -->
        <section id="features" class="features-grid" data-section="features">
          <div class="feature-card">
            <div class="feature-icon">ğŸ“š</div>
            <h3>Recipe Library</h3>
            <p>Organize, categorize, and manage your recipe collection with advanced search and filtering capabilities.</p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">ğŸ§ª</div>
            <h3>Recipe Developer</h3>
            <p>Create and refine recipes with step-by-step instructions, ingredient scaling, and nutritional analysis.</p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">âš¡</div>
            <h3>Quick Upload</h3>
            <p>Import recipes from images, PDFs, or URLs with intelligent parsing and automatic ingredient detection.</p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">ğŸ½ï¸</div>
            <h3>Menu Builder</h3>
            <p>Design professional menus with pricing, descriptions, and dietary information for your restaurant or catering business.</p>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">ğŸ¥¬</div>
            <h3>Ingredient Database</h3>
            <p>Comprehensive ingredient library with nutritional data, suppliers, and cost tracking for better menu planning.</p>
            <div class="ingredient-stats mt-3">
              <div class="text-sm text-gray-600">
                <span id="ingredient-count">Loading...</span> ingredients available
              </div>
              <div class="text-xs text-gray-500">
                <span id="user-ingredients">0</span> custom ingredients
              </div>
            </div>
            <div class="mt-3">
              <button onclick="showIngredientSearch()" class="btn btn-sm btn-secondary">ğŸ” Search</button>
              <button onclick="showAddIngredient()" class="btn btn-sm btn-primary">â• Add New</button>
            </div>
          </div>
          
          <div class="feature-card">
            <div class="feature-icon">ğŸ”§</div>
            <h3>Equipment Management</h3>
            <p>Track kitchen equipment, maintenance schedules, and vendor relationships to optimize your operations.</p>
          </div>
        </section>

        <!-- Recipe Ideas Notepad Section -->
        <section class="ideas-notepad-section">
          <div class="ideas-notepad-header">
            <h3 class="ideas-notepad-title">ğŸ’¡ Recipe Ideas Notepad</h3>
            <div class="ideas-notepad-actions">
              <button class="btn btn-sm btn-secondary" onclick="refreshRecipeIdeas()" title="Refresh Ideas">
                ğŸ”„ Refresh
              </button>
              <button class="btn btn-sm btn-info" onclick="debugRecipeIdeasStorage()" title="Debug Storage">
                ğŸ› Debug
              </button>
              <button class="btn btn-sm btn-warning" onclick="testRecipeIdeasStorage()" title="Test Storage">
                ğŸ§ª Test
              </button>
              <button class="btn btn-sm btn-primary" onclick="viewAllIdeas()" title="View All Ideas">
                ğŸ“‹ View All
              </button>
              <button class="btn btn-sm btn-info" onclick="window.importUsersFromJSON()" title="Import Users from JSON">
                ğŸ‘¥ Import Users
              </button>
            </div>
          </div>
          
          <div class="ideas-notepad-grid">
            <!-- Quick Idea Capture -->
            <div class="quick-idea-card">
              <div class="idea-card-header">
                <h3 class="heading-3">Quick Idea Capture</h3>
                <span class="idea-counter">ğŸ’­ <span id="idea-count">0</span> ideas captured</span>
              </div>
              
              <form id="quick-idea-form" class="idea-form">
                <div class="form-group">
                  <label for="idea-title" class="form-label">Recipe Idea Title</label>
                  <input type="text" id="idea-title" class="form-input" placeholder="e.g., Spicy Mango Salsa, Chocolate Lavender Cake..." required>
                </div>
                
                <div class="form-group">
                  <label for="idea-description" class="form-label">Description & Inspiration</label>
                  <textarea id="idea-description" class="form-textarea" placeholder="What inspired this idea? What flavors, textures, or techniques are you thinking about?" rows="3"></textarea>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label for="idea-cuisine" class="form-label">Cuisine Type</label>
                    <select id="idea-cuisine" class="form-select">
                      <option value="">Select Cuisine...</option>
                      <option value="italian">Italian</option>
                      <option value="mexican">Mexican</option>
                      <option value="asian">Asian</option>
                      <option value="mediterranean">Mediterranean</option>
                      <option value="american">American</option>
                      <option value="french">French</option>
                      <option value="indian">Indian</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  
                  <div class="form-group">
                    <label for="idea-difficulty" class="form-label">Difficulty Level</label>
                    <select id="idea-difficulty" class="form-select">
                      <option value="">Select Difficulty...</option>
                      <option value="easy">Easy</option>
                      <option value="medium">Medium</option>
                      <option value="hard">Hard</option>
                    </select>
                  </div>
                </div>
                
                <div class="form-group">
                  <label for="idea-ingredients" class="form-label">Key Ingredients (Optional)</label>
                  <textarea id="idea-ingredients" class="form-textarea" placeholder="List any key ingredients you have in mind..." rows="2"></textarea>
                </div>
                
                <div class="form-group">
                  <label for="idea-url" class="form-label">URL (Optional)</label>
                  <div class="url-input-group">
                    <input type="url" id="idea-url" class="form-input" placeholder="https://example.com/recipe-inspiration">
                    <button type="button" class="btn btn-info btn-sm" onclick="fetchRecipeFromURL()" title="Fetch recipe data from URL" id="fetch-recipe-btn">
                      ğŸ”— Fetch Recipe
                    </button>
                  </div>
                  <div id="url-fetch-status" class="url-fetch-status"></div>
                </div>
                
                <div class="form-actions">
                  <button type="submit" class="btn btn-primary">ğŸ’¾ Save Idea</button>
                  <button type="button" class="btn btn-secondary" onclick="clearIdeaForm()">Clear Form</button>
                  <button type="button" class="btn btn-success" onclick="createRecipeFromIdea()">ğŸ§ª Create Recipe</button>
                </div>
              </form>
            </div>
            
            <!-- Recent Ideas -->
            <div class="recent-ideas-card">
              <div class="idea-card-header">
                <h3 class="heading-3">Recent Ideas</h3>
                <button class="btn btn-sm btn-secondary" onclick="viewAllIdeas()">View All</button>
              </div>
              
              <div id="recent-ideas-list" class="ideas-list">
                <p class="text-gray-500">No ideas captured yet</p>
              </div>
            </div>
          </div>
          
          <!-- Ideas Summary -->
          <div class="ideas-summary-card">
            <div class="ideas-summary-header">
              <h3 class="heading-3">Ideas Summary</h3>
              <div class="summary-stats">
                <span class="stat-item">ğŸ’¡ <span id="total-ideas">0</span> Total Ideas</span>
                <span class="stat-item">ğŸ§ª <span id="ideas-in-progress">0</span> In Progress</span>
                <span class="stat-item">âœ… <span id="completed-recipes">0</span> Completed</span>
              </div>
            </div>
            
            <div class="ideas-search">
              <input type="text" id="ideas-search" class="form-input" placeholder="Search through your recipe ideas...">
              <button class="btn btn-secondary" onclick="searchIdeas()">ğŸ” Search</button>
            </div>
            
            <div id="ideas-search-results" class="search-results">
              <!-- Search results will appear here -->
            </div>
          </div>
        </section>

        <!-- Dashboard Cards -->
        <section class="dashboard-grid">
          <div class="dashboard-card">
            <div class="dashboard-card-header">
              <div class="dashboard-card-title">Recent Activity</div>
            </div>
            <div id="recent-activity">
              <p class="text-gray-500">No recent activity</p>
            </div>
          </div>
          
          <div class="dashboard-card">
            <div class="dashboard-card-header">
              <div class="dashboard-card-title">Quick Actions</div>
            </div>
            <div class="flex flex-col gap-3">
              <a href="recipe-upload.html" class="btn btn-primary">Upload New Recipe</a>
              <a href="ingredients.html" class="btn btn-secondary">Add Ingredient</a>
              <a href="menu-builder.html" class="btn btn-secondary">Create Menu</a>
            </div>
          </div>
          
          <div class="dashboard-card">
            <div class="dashboard-card-header">
              <div class="dashboard-card-title">Project Management</div>
            </div>
            <div class="flex flex-col gap-3">
              <button onclick="createNewProject()" class="btn btn-primary">â• Create New Project</button>
              <button onclick="manageProjects()" class="btn btn-secondary">ğŸ“‹ Manage Projects</button>
              <div id="project-status" class="text-sm text-gray-600">
                <p>No active projects</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Daily Notes & Calendar Section -->
        <section class="notes-calendar-section">
          <div class="notes-calendar-header">
            <h2 class="heading-2">ğŸ“… Daily Notes & Calendar</h2>
            <div class="notes-actions">
              <button class="btn btn-primary" onclick="openCalendarView()">ğŸ“… Full Calendar</button>
              <button class="btn btn-secondary" onclick="exportNotes()">ğŸ“¤ Export Notes</button>
            </div>
          </div>
          
          <div class="notes-calendar-grid">
            <!-- Daily Notes Form -->
            <div class="daily-notes-card">
              <div class="notes-card-header">
                <h3 class="heading-3">Today's Notes</h3>
                <div class="date-selector">
                  <input type="date" id="notes-date" class="form-input" onchange="loadDailyNotes(this.value)">
                </div>
              </div>
              
              <form id="daily-notes-form" class="notes-form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="kitchen-notes" class="form-label">Kitchen Notes</label>
                    <textarea id="kitchen-notes" class="form-textarea" placeholder="Kitchen observations, equipment issues, staff notes..."></textarea>
                  </div>
                  <div class="form-group">
                    <label for="service-notes" class="form-label">Service Notes</label>
                    <textarea id="service-notes" class="form-textarea" placeholder="Customer feedback, service improvements, special requests..."></textarea>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label for="recipe-notes" class="form-label">Recipe Development</label>
                    <textarea id="recipe-notes" class="form-textarea" placeholder="Recipe experiments, modifications, new ideas..."></textarea>
                  </div>
                  <div class="form-group">
                    <label for="ingredient-notes" class="form-label">Ingredient Notes</label>
                    <textarea id="ingredient-notes" class="form-textarea" placeholder="Ingredient quality, supplier notes, cost changes..."></textarea>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label for="menu-notes" class="form-label">Menu Planning</label>
                    <textarea id="menu-notes" class="form-textarea" placeholder="Menu changes, seasonal updates, pricing notes..."></textarea>
                  </div>
                  <div class="form-group">
                    <label for="general-notes" class="form-label">General Notes</label>
                    <textarea id="general-notes" class="form-textarea" placeholder="Any other observations or ideas..."></textarea>
                  </div>
                </div>
                
                <div class="form-actions">
                  <button type="submit" class="btn btn-primary">ğŸ’¾ Save Notes</button>
                  <button type="button" class="btn btn-secondary" onclick="clearNotesForm()">Clear Form</button>
                  <button type="button" class="btn btn-secondary" onclick="loadPreviousNotes()">ğŸ“š Previous Notes</button>
                </div>
              </form>
            </div>
            
            <!-- Quick Calendar View -->
            <div class="quick-calendar-card">
              <div class="notes-card-header">
                <h3 class="heading-3">Quick Calendar</h3>
                <div class="calendar-nav">
                  <button class="btn btn-sm btn-secondary" onclick="previousMonth()">â€¹</button>
                  <span id="current-month" class="month-display">December 2024</span>
                  <button class="btn btn-sm btn-secondary" onclick="nextMonth()">â€º</button>
                </div>
              </div>
              
              <div class="mini-calendar" id="mini-calendar">
                <!-- Calendar will be populated by JavaScript -->
              </div>
              
              <div class="calendar-events">
                <h4 class="heading-4">Today's Events</h4>
                <div id="today-events" class="events-list">
                  <p class="text-gray-500">No events scheduled</p>
                </div>
                <button class="btn btn-secondary" onclick="addQuickEvent()">â• Add Event</button>
              </div>
            </div>
          </div>
          
          <!-- Notes Summary -->
          <div class="notes-summary-card">
            <div class="notes-card-header">
              <h3 class="heading-3">Notes Summary</h3>
              <div class="summary-stats">
                <span class="stat-item">ğŸ“ <span id="total-notes">0</span> Notes</span>
                <span class="stat-item">ğŸ“… <span id="notes-days">0</span> Days</span>
                <span class="stat-item">ğŸ” <span id="searchable-notes">0</span> Searchable</span>
              </div>
            </div>
            
            <div class="notes-search">
              <input type="text" id="notes-search" class="form-input" placeholder="Search through all notes...">
              <button class="btn btn-secondary" onclick="searchNotes()">ğŸ” Search</button>
            </div>
            
            <div id="notes-search-results" class="search-results">
              <!-- Search results will appear here -->
            </div>
          </div>
        </section>
      </div>
    </main>
    <script>
      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸš€ Initializing Iterum App...');
        
        // Initialize the authentication system
        if (window.IterumApp) {
          window.IterumApp.init();
        }
        
        // Initialize header user synchronization
        if (window.HeaderUserSync) {
          window.HeaderUserSync.init();
        }
        
        // Initialize project management system
        if (window.projectManager) {
          window.projectManager.init();
        }
        
        // Check if user is already authenticated and show user toggle
        checkAndShowUserToggle();
        
        // Listen for project changes to reload recipe ideas
        document.addEventListener('projectChanged', function(event) {
          console.log('ğŸ“‹ Project changed, reloading recipe ideas...');
          if (event.detail && event.detail.project) {
            // Reload ideas for the new project
            loadRecipeIdeas();
            updateIdeasDisplay();
            updateIdeasStats();
          }
        });
        
        console.log('âœ… Iterum App initialized');
      });
      
      // Check if user is authenticated and show user toggle
      function checkAndShowUserToggle() {
        const currentUser = localStorage.getItem('current_user');
        const sessionActive = localStorage.getItem('session_active');
        
        if (currentUser && sessionActive === 'true') {
          try {
            const user = JSON.parse(currentUser);
            showUserToggle(user);
          } catch (error) {
            console.error('âŒ Error parsing user data:', error);
          }
        }
      }
      
      // Show user toggle after authentication
      function showUserToggle(user) {
        const userTab = document.getElementById('header-user-tab');
        const currentUserElement = document.getElementById('current-user');
        const dropdownUserName = document.getElementById('dropdown-user-name');
        const userAvatarInitial = document.getElementById('user-avatar-initial');
        
        if (userTab && currentUserElement && dropdownUserName && userAvatarInitial) {
          // Update user info
          currentUserElement.textContent = user.name;
          dropdownUserName.textContent = user.name;
          userAvatarInitial.textContent = user.name.charAt(0).toUpperCase();
          
          // Show user toggle
          userTab.style.display = 'flex';
          
          console.log('âœ… User toggle displayed for:', user.name);
        }
      }
      
      // Listen for user authentication events
      document.addEventListener('userLoggedIn', function(event) {
        if (event.detail && event.detail.user) {
          showUserToggle(event.detail.user);
        }
      });
      
      
      // Listen for showUserToggle event from authentication system
      document.addEventListener('showUserToggle', function(event) {
        if (event.detail && event.detail.user) {
          showUserToggle(event.detail.user);
        }
      });

      // Mobile navigation toggle
      function toggleMobileNav() {
        const mobileNav = document.getElementById('mobile-nav');
        if (mobileNav) {
          mobileNav.classList.toggle('show');
        }
      }

      // Initialize notes and calendar functionality
      function initializeNotesAndCalendar() {
        // Set current date
        const today = new Date();
        document.getElementById('notes-date').value = today.toISOString().split('T')[0];
        
        // Initialize mini calendar
        initializeMiniCalendar();
        
        // Load today's notes
        loadDailyNotes(today.toISOString().split('T')[0]);
        
        // Set up form submission
        const notesForm = document.getElementById('daily-notes-form');
        if (notesForm) {
          notesForm.addEventListener('submit', handleNotesSubmit);
        }
        
        // Update stats
        updateNotesStats();
      }

      // Initialize mini calendar
      function initializeMiniCalendar() {
        const calendar = document.getElementById('mini-calendar');
        if (!calendar) return;
        
        const today = new Date();
        const currentMonth = today.getMonth();
        const currentYear = today.getFullYear();
        
        updateCalendarDisplay(currentMonth, currentYear);
        updateMonthDisplay(currentMonth, currentYear);
      }

      // Update calendar display
      function updateCalendarDisplay(month, year) {
        const calendar = document.getElementById('mini-calendar');
        if (!calendar) return;
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay());
        
        let calendarHTML = `
          <div class="calendar-weekdays">
            <div class="calendar-day weekday">Sun</div>
            <div class="calendar-day weekday">Mon</div>
            <div class="calendar-day weekday">Tue</div>
            <div class="calendar-day weekday">Wed</div>
            <div class="calendar-day weekday">Thu</div>
            <div class="calendar-day weekday">Fri</div>
            <div class="calendar-day weekday">Sat</div>
          </div>
          <div class="calendar-grid">
        `;
        
        for (let i = 0; i < 42; i++) {
          const date = new Date(startDate);
          date.setDate(startDate.getDate() + i);
          
          const isCurrentMonth = date.getMonth() === month;
          const isToday = date.toDateString() === new Date().toDateString();
          const hasNotes = checkIfDateHasNotes(date.toISOString().split('T')[0]);
          
          let dayClass = 'calendar-day';
          if (!isCurrentMonth) dayClass += ' other-month';
          if (isToday) dayClass += ' today';
          if (hasNotes) dayClass += ' has-notes';
          
          calendarHTML += `<div class="${dayClass}" onclick="selectCalendarDate('${date.toISOString().split('T')[0]}')">${date.getDate()}</div>`;
        }
        
        calendarHTML += '</div>';
        calendar.innerHTML = calendarHTML;
      }

      // Update month display
      function updateMonthDisplay(month, year) {
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        const monthDisplay = document.getElementById('current-month');
        if (monthDisplay) {
          monthDisplay.textContent = `${monthNames[month]} ${year}`;
        }
      }

      // Navigate to previous month
      function previousMonth() {
        const monthDisplay = document.getElementById('current-month');
        if (!monthDisplay) return;
        
        const currentText = monthDisplay.textContent;
        const [month, year] = currentText.split(' ');
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        
        let currentMonth = monthNames.indexOf(month);
        let currentYear = parseInt(year);
        
        if (currentMonth === 0) {
          currentMonth = 11;
          currentYear--;
        } else {
          currentMonth--;
        }
        
        updateCalendarDisplay(currentMonth, currentYear);
        updateMonthDisplay(currentMonth, currentYear);
      }

      // Navigate to next month
      function nextMonth() {
        const monthDisplay = document.getElementById('current-month');
        if (!monthDisplay) return;
        
        const currentText = monthDisplay.textContent;
        const [month, year] = currentText.split(' ');
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        
        let currentMonth = monthNames.indexOf(month);
        let currentYear = parseInt(year);
        
        if (currentMonth === 11) {
          currentMonth = 0;
          currentYear++;
        } else {
          currentMonth++;
        }
        
        updateCalendarDisplay(currentMonth, currentYear);
        updateMonthDisplay(currentMonth, currentYear);
      }

      // Select calendar date
      function selectCalendarDate(dateString) {
        document.getElementById('notes-date').value = dateString;
        loadDailyNotes(dateString);
      }

      // Check if date has notes
      function checkIfDateHasNotes(dateString) {
        let notes = {};
        
        // Try to load from user-specific file first, fallback to localStorage
        if (window.userDataManager && window.userDataManager.isUserLoggedIn()) {
          const userId = window.userDataManager.getCurrentUserId();
          const filename = `user_${userId}_daily_notes.json`;
          notes = window.userDataManager.loadUserFile(filename) || {};
        } else {
          // Fallback to localStorage
          notes = JSON.parse(localStorage.getItem('iterum_notes') || '{}');
        }
        
        return notes[dateString] && Object.values(notes[dateString]).some(note => note.trim() !== '');
      }

      // Handle notes form submission
      function handleNotesSubmit(event) {
        event.preventDefault();
        
        const date = document.getElementById('notes-date').value;
        const notes = {
          kitchen: document.getElementById('kitchen-notes').value,
          service: document.getElementById('service-notes').value,
          recipe: document.getElementById('recipe-notes').value,
          ingredient: document.getElementById('ingredient-notes').value,
          menu: document.getElementById('menu-notes').value,
          general: document.getElementById('general-notes').value
        };
        
        saveDailyNotes(date, notes);
        
        // Show success message
        showNotification('Notes saved successfully!', 'success');
        
        // Update stats
        updateNotesStats();
        
        // Refresh calendar to show notes indicators
        initializeMiniCalendar();
      }

      // Save daily notes
      function saveDailyNotes(date, notes) {
        // Try to save to user-specific file first, fallback to localStorage
        if (window.userDataManager && window.userDataManager.isUserLoggedIn()) {
          const userId = window.userDataManager.getCurrentUserId();
          const filename = `user_${userId}_daily_notes.json`;
          const allNotes = window.userDataManager.loadUserFile(filename) || {};
          allNotes[date] = notes;
          window.userDataManager.saveUserFile(filename, allNotes);
          console.log('ğŸ’¾ Notes saved to user file for:', date);
        } else {
          // Fallback to localStorage
          const allNotes = JSON.parse(localStorage.getItem('iterum_notes') || '{}');
          allNotes[date] = notes;
          localStorage.setItem('iterum_notes', JSON.stringify(allNotes));
          console.log('ğŸ’¾ Notes saved to localStorage for:', date);
        }
      }

      // Load daily notes
      function loadDailyNotes(date) {
        let allNotes = {};
        
        // Try to load from user-specific file first, fallback to localStorage
        if (window.userDataManager && window.userDataManager.isUserLoggedIn()) {
          const userId = window.userDataManager.getCurrentUserId();
          const filename = `user_${userId}_daily_notes.json`;
          allNotes = window.userDataManager.loadUserFile(filename) || {};
          console.log('ğŸ“– Notes loaded from user file for:', date);
        } else {
          // Fallback to localStorage
          allNotes = JSON.parse(localStorage.getItem('iterum_notes') || '{}');
          console.log('ğŸ“– Notes loaded from localStorage for:', date);
        }
        
        const notes = allNotes[date] || {};
        
        document.getElementById('kitchen-notes').value = notes.kitchen || '';
        document.getElementById('service-notes').value = notes.service || '';
        document.getElementById('recipe-notes').value = notes.recipe || '';
        document.getElementById('ingredient-notes').value = notes.ingredient || '';
        document.getElementById('menu-notes').value = notes.menu || '';
        document.getElementById('general-notes').value = notes.general || '';
      }

      // Clear notes form
      function clearNotesForm() {
        document.getElementById('daily-notes-form').reset();
        showNotification('Form cleared!', 'info');
      }

      // Load previous notes
      function loadPreviousNotes() {
        const date = document.getElementById('notes-date').value;
        const currentDate = new Date(date);
        currentDate.setDate(currentDate.getDate() - 1);
        
        const previousDate = currentDate.toISOString().split('T')[0];
        document.getElementById('notes-date').value = previousDate;
        loadDailyNotes(previousDate);
        
        showNotification('Previous day notes loaded!', 'info');
      }

      // Update notes statistics
      function updateNotesStats() {
        let allNotes = {};
        
        // Try to load from user-specific file first, fallback to localStorage
        if (window.userDataManager && window.userDataManager.isUserLoggedIn()) {
          const userId = window.userDataManager.getCurrentUserId();
          const filename = `user_${userId}_daily_notes.json`;
          allNotes = window.userDataManager.loadUserFile(filename) || {};
        } else {
          // Fallback to localStorage
          allNotes = JSON.parse(localStorage.getItem('iterum_notes') || '{}');
        }
        
        const dates = Object.keys(allNotes);
        const totalNotes = dates.reduce((count, date) => {
          const dayNotes = allNotes[date];
          return count + Object.values(dayNotes).filter(note => note.trim() !== '').length;
        }, 0);
        
        document.getElementById('total-notes').textContent = totalNotes;
        document.getElementById('notes-days').textContent = dates.length;
        document.getElementById('searchable-notes').textContent = totalNotes;
      }

      // Search notes
      function searchNotes() {
        const searchTerm = document.getElementById('notes-search').value.toLowerCase();
        if (!searchTerm.trim()) {
          showNotification('Please enter a search term', 'warning');
          return;
        }
        
        let allNotes = {};
        
        // Try to load from user-specific file first, fallback to localStorage
        if (window.userDataManager && window.userDataManager.isUserLoggedIn()) {
          const userId = window.userDataManager.getCurrentUserId();
          const filename = `user_${userId}_daily_notes.json`;
          allNotes = window.userDataManager.loadUserFile(filename) || {};
        } else {
          // Fallback to localStorage
          allNotes = JSON.parse(localStorage.getItem('iterum_notes') || '{}');
        }
        
        const results = [];
        
        Object.entries(allNotes).forEach(([date, notes]) => {
          Object.entries(notes).forEach(([category, content]) => {
            if (content.toLowerCase().includes(searchTerm)) {
              results.push({
                date,
                category,
                content: content.substring(0, 100) + (content.length > 100 ? '...' : ''),
                fullContent: content
              });
            }
          });
        });
        
        displaySearchResults(results);
      }

      // Display search results
      function displaySearchResults(results) {
        const resultsContainer = document.getElementById('notes-search-results');
        if (!resultsContainer) return;
        
        if (results.length === 0) {
          resultsContainer.innerHTML = '<p class="text-gray-500">No notes found matching your search.</p>';
          return;
        }
        
        let resultsHTML = `<h4 class="heading-4 mb-3">Found ${results.length} results:</h4>`;
        results.forEach(result => {
          resultsHTML += `
            <div class="search-result-item p-3 bg-gray-50 rounded-lg mb-2">
              <div class="flex justify-between items-start mb-2">
                <span class="font-medium text-sm">${result.category}</span>
                <span class="text-xs text-gray-500">${new Date(result.date).toLocaleDateString()}</span>
              </div>
              <p class="text-sm text-gray-700">${result.content}</p>
            </div>
          `;
        });
        
        resultsContainer.innerHTML = resultsHTML;
      }

      // Add quick event
      function addQuickEvent() {
        const eventName = prompt('Enter event name:');
        if (eventName && eventName.trim()) {
          const today = new Date().toISOString().split('T')[0];
          const events = JSON.parse(localStorage.getItem('iterum_events') || '{}');
          
          if (!events[today]) events[today] = [];
          events[today].push({
            id: Date.now(),
            name: eventName.trim(),
            time: '12:00'
          });
          
          localStorage.setItem('iterum_events', JSON.stringify(events));
          updateTodayEvents();
          showNotification('Event added!', 'success');
        }
      }

      // Update today's events
      function updateTodayEvents() {
        const today = new Date().toISOString().split('T')[0];
        const events = JSON.parse(localStorage.getItem('iterum_events') || '{}');
        const todayEvents = events[today] || [];
        
        const eventsContainer = document.getElementById('today-events');
        if (!eventsContainer) return;
        
        if (todayEvents.length === 0) {
          eventsContainer.innerHTML = '<p class="text-gray-500">No events scheduled</p>';
          return;
        }
        
        let eventsHTML = '';
        todayEvents.forEach(event => {
          eventsHTML += `
            <div class="event-item flex justify-between items-center p-2 bg-iterum-primary-light rounded mb-2">
              <span class="text-sm font-medium">${event.name}</span>
              <span class="text-xs text-gray-600">${event.time}</span>
            </div>
          `;
        });
        
        eventsContainer.innerHTML = eventsHTML;
      }

      // Open calendar view
      function openCalendarView() {
        showNotification('Full calendar view coming soon!', 'info');
        // TODO: Implement full calendar view
      }

      // Export notes
      function exportNotes() {
        const allNotes = JSON.parse(localStorage.getItem('iterum_notes') || '{}');
        const dataStr = JSON.stringify(allNotes, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `iterum-notes-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showNotification('Notes exported successfully!', 'success');
      }

      // Show notification
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all duration-300 transform translate-x-full`;
        
        const colors = {
          success: 'bg-green-500 text-white',
          error: 'bg-red-500 text-white',
          warning: 'bg-yellow-500 text-white',
          info: 'bg-blue-500 text-white'
        };
        
        notification.className += ` ${colors[type] || colors.info}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => notification.classList.remove('translate-x-full'), 100);
        
        // Auto remove
        setTimeout(() => {
          notification.classList.add('translate-x-full');
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      // Toggle user dropdown
      function toggleUserDropdown() {
        const dropdown = document.getElementById('user-dropdown');
        if (dropdown) {
          dropdown.classList.toggle('show');
        }
      }

      // Close dropdowns when clicking outside
      document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('user-dropdown');
        const userTab = document.querySelector('.header-user-tab');
        
        if (dropdown && !userTab.contains(event.target)) {
          dropdown.classList.remove('show');
        }
      });
    </script>

    <!-- Load Security Utils First -->
    <script src="assets/js/security-utils.js"></script>
    <script src="assets/js/csp-config.js"></script>
    <script src="assets/js/input-validation.js"></script>
    <script src="assets/js/api-security.js"></script>
    
    <!-- HOTFIX: Load auth crash fix -->
    <script src="hotfix_auth_crash.js"></script>
    
    <!-- Load Firebase Configuration FIRST -->
    <script src="assets/js/firebase-config.js"></script>
    
    <!-- Wait a moment for config to be available -->
    <script>
        // Ensure config is available before loading modules
        window.firebaseConfigReady = true;
        console.log('âœ… Firebase config loaded and ready');
    </script>
    
    <!-- Load Firebase Authentication -->
    <script type="module" src="assets/js/firebase-auth.js"></script>
    <script type="module" src="assets/js/firebase-auth-ui.js"></script>
    
    <!-- Load Unified Authentication System -->
    <script src="assets/js/unified_auth_system.js"></script>
    
    <!-- Load Page Protection System -->
    <script src="assets/js/page-protection.js"></script>
    
    <!-- Load Header User Synchronization -->
    <script src="assets/js/header_user_sync.js"></script>
    
    <!-- Load Header Sync Loader (ensures sync on all pages) -->
    <script src="assets/js/header_sync_loader.js"></script>
    
    <!-- Load Main Application -->
    <script src="assets/js/main.js"></script>
    <script src="assets/js/ai-integration.js"></script>
    
    <!-- Enhanced User Management now handled by Firebase Auth -->
    
    <!-- Load Project Management System -->
    <script src="assets/js/project-management-system.js"></script>
    
    <!-- Load the user-controlled storage system -->
    <script src="assets/js/userControlledStorage.js"></script>
    
    <!-- Data Tagging System -->
    <script src="assets/js/data-tagging-system.js"></script>
    
    <!-- Ingredient Library System -->
    <script src="assets/js/ingredientLibrary.js"></script>
    
    <!-- Initialize User System -->
    <script>
      // Ensure authentication system is loaded and working
      function initializeUserSystem() {
        console.log('ğŸ” Initializing authentication system...');
        console.log('window.unifiedAuthSystem:', window.unifiedAuthSystem);
        console.log('window.unifiedAuthSystem type:', typeof window.unifiedAuthSystem);
        console.log('window.unifiedAuthSystem constructor:', window.unifiedAuthSystem?.constructor?.name);
        
        if (window.unifiedAuthSystem) {
          console.log('âœ… Authentication system loaded successfully');
          console.log('ğŸ” Auth system properties:', Object.keys(window.unifiedAuthSystem));
          console.log('ğŸ” Current user:', window.unifiedAuthSystem.currentUser);
          console.log('ğŸ” Is authenticated:', window.unifiedAuthSystem.isAuthenticated());
          
          // Update UI with current user
          console.log('ğŸ” Calling updateAuthUI()...');
          window.unifiedAuthSystem.updateAuthUI(window.unifiedAuthSystem.currentUser);
          
          // Authentication system handles user selection automatically
          console.log('ğŸ” Authentication system handles user selection automatically');
          
          // Initialize project system
          console.log('ğŸ” Initializing project system...');
          if (window.projectManager) {
            console.log('âœ… Project manager available');
            // Update project UI
            window.projectManager.updateProjectUI();
          } else {
            console.error('âŒ Project manager not available');
          }
          
          // Initialize data tagging system
          console.log('ğŸ” Initializing data tagging system...');
          if (window.dataTagger) {
            console.log('âœ… Data tagger available');
            // Update project stats display
            if (window.projectManager?.currentProject) {
              const stats = window.dataTagger.getProjectStats(window.projectManager.currentProject.id);
              console.log('ğŸ” Initial project stats:', stats);
            }
          } else {
            console.error('âŒ Data tagger not available');
          }
          
          // Initialize ingredient library
          console.log('ğŸ¥¬ Initializing ingredient library...');
          if (window.ingredientLibrary) {
            console.log('âœ… Ingredient library available');
            // Wait a bit for ingredient library to load, then update stats
            setTimeout(() => {
              updateIngredientStats();
            }, 1000);
            console.log('âœ… Ingredient library initialization scheduled');
          } else {
            console.error('âŒ Ingredient library not available');
          }
          
          // Listen for project changes
          window.addEventListener('projectChanged', (event) => {
            console.log('ğŸ” Project changed event received:', event.detail);
            const { project, isMaster } = event.detail;
            
            // Update project status display
            const projectNameElements = document.querySelectorAll('[data-project-name]');
            projectNameElements.forEach(element => {
              element.textContent = project?.name || 'Unknown Project';
            });
            
            // Show/hide import from master button based on project type
            const importButtons = document.querySelectorAll('[data-import-from-master]');
            importButtons.forEach(button => {
              if (isMaster) {
                button.style.display = 'none'; // Hide on master project
              } else {
                button.style.display = ''; // Show on specific projects
              }
            });
          });
          
          
          // Add click handler for user tab to toggle dropdown
          const userTab = document.querySelector('.header-user-tab');
          const userDropdown = document.getElementById('user-dropdown');
          
          console.log('ğŸ” User tab found:', userTab);
          console.log('ğŸ” User dropdown found:', userDropdown);
          
          if (userTab && userDropdown) {
            userTab.addEventListener('click', function(e) {
              e.stopPropagation();
              console.log('ğŸ” User tab clicked - toggling dropdown');
              userDropdown.classList.toggle('show');
            });
            console.log('âœ… Click handler added to user tab');
            
            // Test the authentication system methods
            console.log('ğŸ” Testing authentication system methods...');
            console.log('showUserSelection exists:', typeof window.unifiedAuthSystem.showUserSelection);
            console.log('createOfflineProfile exists:', typeof window.unifiedAuthSystem.createOfflineProfile);
            console.log('updateAuthUI exists:', typeof window.unifiedAuthSystem.updateAuthUI);
            console.log('isAuthenticated exists:', typeof window.unifiedAuthSystem.isAuthenticated);
          } else {
            console.error('âŒ User tab or dropdown not found');
          }
        } else {
          console.error('âŒ Authentication system not loaded, retrying in 100ms...');
          setTimeout(initializeUserSystem, 100);
        }
      }
      
      // Try to initialize with a small delay to ensure all scripts are loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          // Small delay to ensure all scripts are loaded
          setTimeout(initializeUserSystem, 100);
          
          // Fallback: Ensure authentication is shown after 3 seconds
          setTimeout(() => {
            if (!window.unifiedAuthSystem?.currentUser && !window.unifiedAuthSystem?.isAuthenticated()) {
              console.log('ğŸš¨ Fallback: No authentication found, forcing auth display');
              window.unifiedAuthSystem?.showAuthentication();
            }
          }, 3000);
        });
      } else {
        // Small delay to ensure all scripts are loaded
        setTimeout(initializeUserSystem, 100);
        
        // Fallback: Ensure authentication is shown after 3 seconds
        setTimeout(() => {
          if (!window.unifiedAuthSystem?.currentUser && !window.unifiedAuthSystem?.isAuthenticated()) {
            console.log('ğŸš¨ Fallback: No authentication found, forcing auth display');
            window.unifiedAuthSystem?.showAuthentication();
          }
        }, 3000);
      }
      
      // Also log when the script loads
      console.log('ğŸš€ Authentication system initialization script loaded');
      
      // Debug function for authentication system
      window.debugAuthSystem = function() {
        console.log('ğŸ› Debug Auth System');
        console.log('window.unifiedAuthSystem:', window.unifiedAuthSystem);
        console.log('window.firebaseAuth:', window.firebaseAuth);
        console.log('window.firebaseAuthUI:', window.firebaseAuthUI);
        console.log('Current user:', window.unifiedAuthSystem?.currentUser);
        console.log('Is authenticated:', window.unifiedAuthSystem?.isAuthenticated());
        console.log('Session active:', localStorage.getItem('session_active'));
        console.log('Current user stored:', localStorage.getItem('current_user'));
        
        // Try to show authentication
        if (window.unifiedAuthSystem) {
          window.unifiedAuthSystem.showAuthentication();
        } else {
          alert('Authentication system not available. Check console for details.');
        }
      };
      
      // Test function for debugging
      async function testUserSystemOnIndex() {
        console.log('ğŸ§ª Testing authentication system on index page...');
        console.log('window.unifiedAuthSystem:', window.unifiedAuthSystem);
        
        if (window.unifiedAuthSystem) {
          console.log('âœ… Authentication system is available');
          console.log('ğŸ” Auth system properties:', Object.keys(window.unifiedAuthSystem));
          console.log('Current user:', window.unifiedAuthSystem.currentUser);
          console.log('Is authenticated:', window.unifiedAuthSystem.isAuthenticated());
          
          // Test creating an offline profile
          try {
            console.log('ğŸ” Creating test offline profile...');
            const testProfile = {
              name: 'Test User ' + Date.now(),
              email: 'test@example.com',
              avatar: 'ğŸ‘¨â€ğŸ³'
            };
            
            window.unifiedAuthSystem.createOfflineProfile(testProfile);
            
            console.log('âœ… Test profile created successfully');
            console.log('ğŸ” Current user after creation:', window.unifiedAuthSystem.currentUser);
            alert('Test profile created successfully! Check console for details.');
          } catch (error) {
            console.error('âŒ Error creating test profile:', error);
            alert('Error creating test profile: ' + error.message);
          }
        } else {
          console.log('âŒ Authentication system is not available');
          alert('Authentication system is not available. Check console for details.');
        }
      }

      // Test function for debugging project system
      function testProjectSystemOnIndex() {
        console.log('ğŸ“‹ Testing project system on index page...');
        console.log('window.projectManager:', window.projectManager);
        console.log('window.projectManager type:', typeof window.projectManager);
        console.log('window.projectManager constructor:', window.projectManager?.constructor?.name);

        if (window.projectManager) {
          console.log('âœ… Project manager is available');
          console.log('ğŸ” Project manager properties:', Object.keys(window.projectManager));
          console.log('ğŸ” Current project:', window.projectManager.currentProject);
          console.log('ğŸ” Total projects:', window.projectManager.projects?.length);

          // Test creating a project
          try {
            console.log('ğŸ” Creating test project...');
            const newProject = window.projectManager.createProject({
              name: 'Test Project ' + Date.now(),
              description: 'This is a test project for the Iterum Chef Notebook.',
              isMaster: false
            });

            console.log('ğŸ” Test project creation result:', newProject);

            if (newProject) {
              console.log('âœ… Test project created successfully:', newProject);
              console.log('ğŸ” Current project after creation:', window.projectManager.currentProject);
              console.log('ğŸ” Total projects after creation:', window.projectManager.projects.length);
              alert('Test project created successfully! Check console for details.');
            } else {
              console.log('âŒ Failed to create test project');
              alert('Failed to create test project. Check console for details.');
            }
          } catch (error) {
            console.error('âŒ Error creating test project:', error);
            alert('Error creating test project: ' + error.message);
          }
        } else {
          console.log('âŒ Project manager is not available');
          alert('Project manager is not available. Check console for details.');
                 }
       }

       // Project Management Functions
       function createNewProject() {
         console.log('ğŸ” Creating new project...');
         
         if (!window.projectManager) {
           console.error('âŒ Project manager not available');
           alert('Project management system is not loaded. Please refresh the page and try again.');
           return;
         }
         
         // Show the project creation modal
         try {
           window.projectManager.showProjectModal();
           console.log('âœ… Project creation modal opened');
         } catch (error) {
           console.error('âŒ Error opening project modal:', error);
           alert('Error opening project creation modal: ' + error.message);
         }
       }

       function manageProjects() {
         console.log('ğŸ” Managing projects...');
         
         if (!window.projectManager) {
           console.error('âŒ Project manager not available');
           alert('Project management system is not loaded. Please refresh the page and try again.');
           return;
         }
         
         // Show the project management modal
         try {
           window.projectManager.showProjectModal('manage');
           console.log('âœ… Project management modal opened');
         } catch (error) {
           console.error('âŒ Error opening project management modal:', error);
           alert('Error opening project management modal: ' + error.message);
         }
       }

                  function showProjectInfo() {
             console.log('ğŸ” Showing project info...');
             
             if (!window.projectManager) {
               console.error('âŒ Project manager not available');
               alert('Project management system is not loaded. Please refresh the page and try again.');
               return;
             }
             
             const currentProject = window.projectManager.getCurrentProject();
             const allProjects = window.projectManager.projects || [];
             
             if (currentProject) {
               const projectInfo = `Current Project: ${currentProject.name}\nType: ${currentProject.isMaster ? 'Master Project' : 'Regular Project'}\nDescription: ${currentProject.description || 'No description'}\nTotal Projects: ${allProjects.length}`;
               alert(projectInfo);
             } else {
               alert('No current project selected.');
             }
           }
           
           // Ingredient Management Functions
           function showIngredientSearch() {
             console.log('ğŸ” Opening ingredient search...');
             window.open('ingredients.html', '_blank');
           }
           
           function showAddIngredient() {
             console.log('â• Opening add ingredient form...');
             window.open('ingredients.html#add', '_blank');
           }
           
           function updateIngredientStats() {
             console.log('ğŸ“Š Updating ingredient statistics...');
             
             if (!window.ingredientLibrary) {
               console.log('âŒ Ingredient library not available yet');
               return;
             }
             
             try {
               const totalIngredients = window.ingredientLibrary.ingredients.length || 0;
               const userIngredients = window.ingredientLibrary.getUserIngredients().length || 0;
               
               const countElement = document.getElementById('ingredient-count');
               const userElement = document.getElementById('user-ingredients');
               
               if (countElement) countElement.textContent = totalIngredients;
               if (userElement) userElement.textContent = userIngredients;
               
               console.log(`âœ… Updated ingredient stats: ${totalIngredients} total, ${userIngredients} user`);
             } catch (error) {
               console.error('âŒ Error updating ingredient stats:', error);
             }
           }

       // Test function for debugging data tagging system
       function testDataTaggingSystemOnIndex() {
         console.log('ğŸ·ï¸ Testing data tagging system on index page...');
         console.log('window.dataTagger:', window.dataTagger);
         console.log('window.dataTagger type:', typeof window.dataTagger);
         console.log('window.dataTagger constructor:', window.dataTagger?.constructor?.name);

         if (window.dataTagger) {
           console.log('âœ… Data tagger is available');
           console.log('ğŸ” Data tagger properties:', Object.keys(window.dataTagger));
           
           // Test creating some sample tags
           try {
             console.log('ğŸ” Creating test data tags...');
             
             // Get current project
             const currentProject = window.projectManager?.getCurrentProject();
             if (currentProject) {
               console.log('ğŸ” Current project for tagging:', currentProject);
               
               // Tag some sample items
               const testIngredients = ['ingredient_001', 'ingredient_002', 'ingredient_003'];
               const testRecipes = ['recipe_001', 'recipe_002'];
               const testMenus = ['menu_001'];
               
               // Tag ingredients
               testIngredients.forEach(ingredientId => {
                 window.dataTagger.tagItem(currentProject.id, 'ingredients', ingredientId);
               });
               
               // Tag recipes
               testRecipes.forEach(recipeId => {
                 window.dataTagger.tagItem(currentProject.id, 'recipes', recipeId);
               });
               
               // Tag menus
               testMenus.forEach(menuId => {
                 window.dataTagger.tagItem(currentProject.id, 'menus', menuId);
               });
               
               // Get project stats
               const stats = window.dataTagger.getProjectStats(currentProject.id);
               console.log('ğŸ” Project stats after tagging:', stats);
               
               // Update project UI to show new stats
               if (window.projectManager) {
                 window.projectManager.updateProjectUI();
               }
               
               alert(`Test data tags created successfully!\n\nProject: ${currentProject.name}\nIngredients: ${stats.ingredients}\nRecipes: ${stats.recipes}\nMenus: ${stats.menus}\nTotal: ${stats.total}\n\nCheck console for details.`);
             } else {
               console.log('âŒ No current project available');
               alert('No current project available. Please create or select a project first.');
             }
           } catch (error) {
             console.error('âŒ Error creating test data tags:', error);
             alert('Error creating test data tags: ' + error.message);
           }
         } else {
           console.log('âŒ Data tagger is not available');
           alert('Data tagger is not available. Check console for details.');
         }
       }

       // Recipe Ideas System
       let recipeIdeas = [];
       let ideasCounter = 0;

       // Initialize ideas system
       function initializeIdeasSystem() {
         console.log('ğŸ’¡ Initializing Recipe Ideas System...');
         
         // Wait for project manager to be ready
         if (window.projectManager && window.projectManager.getCurrentProject()) {
           console.log('âœ… Project manager ready, loading ideas...');
           loadRecipeIdeas();
           updateIdeasDisplay();
           updateIdeasStats();
         } else {
           console.log('â³ Project manager not ready, waiting...');
           // Retry after a short delay
           setTimeout(() => {
             if (window.projectManager && window.projectManager.getCurrentProject()) {
               console.log('âœ… Project manager now ready, loading ideas...');
               loadRecipeIdeas();
               updateIdeasDisplay();
               updateIdeasStats();
             } else {
               console.log('âš ï¸ Project manager still not ready, using fallback...');
               // Use fallback initialization
               loadRecipeIdeas();
               updateIdeasDisplay();
               updateIdeasStats();
             }
           }, 500);
         }
         
         // Set up form submission
         const ideaForm = document.getElementById('quick-idea-form');
         if (ideaForm) {
           ideaForm.addEventListener('submit', handleIdeaSubmission);
         }

         // Set up URL field blur event for automatic recipe fetching
         const urlInput = document.getElementById('idea-url');
         if (urlInput) {
           urlInput.addEventListener('blur', function() {
             // Only fetch if there's a URL and it looks like a recipe site
             const url = this.value.trim();
             if (url && (url.includes('recipe') || url.includes('food') || url.includes('cooking') || url.includes('chef'))) {
               // Small delay to let user finish typing
               setTimeout(() => {
                 if (this.value.trim() === url) {
                   fetchRecipeFromURL();
                 }
               }, 500);
             }
           });
         }
       }
       
       // Load recipe ideas from project-aware storage
       function loadRecipeIdeas() {
         console.log('ğŸ” Starting recipe ideas load...');
         console.log('ğŸ” Project manager available:', !!window.projectManager);
         console.log('ğŸ” Current project:', window.projectManager?.getCurrentProject());
         
         try {
           // Try to load from project-aware storage first
           if (window.projectManager && window.projectManager.getCurrentProject()) {
             const currentProject = window.projectManager.getCurrentProject();
             const projectKey = window.projectManager.getProjectStorageKey('recipe_ideas');
             console.log('ğŸ” Project key generated:', projectKey);
             
             const storedIdeas = localStorage.getItem(projectKey);
             console.log('ğŸ” Stored ideas found:', !!storedIdeas);
             
             if (storedIdeas) {
               recipeIdeas = JSON.parse(storedIdeas);
               console.log('ğŸ“¥ Loaded', recipeIdeas.length, 'recipe ideas from project:', projectKey);
             } else {
               recipeIdeas = [];
               console.log('ğŸ“­ No recipe ideas found for current project');
               
               // Check if there are ideas in global storage that should be migrated
               migrateGlobalIdeasToProject();
             }
           } else {
             console.log('ğŸ“­ No project manager or current project, using global storage');
             // Fallback to global storage
             const globalIdeas = localStorage.getItem('recipe_ideas');
             console.log('ğŸ” Global ideas found:', !!globalIdeas);
             
             recipeIdeas = JSON.parse(globalIdeas || '[]');
             console.log('ğŸ“¥ Loaded', recipeIdeas.length, 'recipe ideas from global storage');
           }
           
           ideasCounter = recipeIdeas.length;
           console.log('âœ… Recipe ideas load complete. Total ideas:', ideasCounter);
           
         } catch (error) {
           console.error('âŒ Error loading recipe ideas:', error);
           recipeIdeas = [];
           ideasCounter = 0;
         }
       }
       
       // Migrate global ideas to current project
       function migrateGlobalIdeasToProject() {
         try {
           const globalIdeas = JSON.parse(localStorage.getItem('recipe_ideas') || '[]');
           if (globalIdeas.length > 0 && window.projectManager && window.projectManager.getCurrentProject()) {
             console.log('ğŸ”„ Migrating', globalIdeas.length, 'ideas from global storage to current project...');
             
             // Copy ideas to current project
             recipeIdeas = [...globalIdeas];
             ideasCounter = recipeIdeas.length;
             
             // Save to project storage
             saveRecipeIdeas();
             
             // Clear global storage
             localStorage.removeItem('recipe_ideas');
             
             console.log('âœ… Successfully migrated ideas to project:', window.projectManager.getCurrentProject().name);
           }
           
           // Also migrate in-progress recipes
           migrateGlobalRecipesToProject();
         } catch (error) {
           console.error('âŒ Error migrating global ideas:', error);
         }
       }
       
       // Migrate global in-progress recipes to current project
       function migrateGlobalRecipesToProject() {
         try {
           const globalRecipes = JSON.parse(localStorage.getItem('recipes_in_progress') || '[]');
           if (globalRecipes.length > 0 && window.projectManager && window.projectManager.getCurrentProject()) {
             console.log('ğŸ”„ Migrating', globalRecipes.length, 'in-progress recipes from global storage to current project...');
             
             // Save to project storage
             const projectKey = window.projectManager.getProjectStorageKey('recipes_in_progress');
             localStorage.setItem(projectKey, JSON.stringify(globalRecipes));
             
             // Clear global storage
             localStorage.removeItem('recipes_in_progress');
             
             console.log('âœ… Successfully migrated in-progress recipes to project:', window.projectManager.getCurrentProject().name);
           }
         } catch (error) {
           console.error('âŒ Error migrating global recipes:', error);
         }
       }

       // Save recipe ideas to project-aware storage
       function saveRecipeIdeas() {
         try {
           if (window.projectManager && window.projectManager.getCurrentProject()) {
             // Save to project-specific storage
             const projectKey = window.projectManager.getProjectStorageKey('recipe_ideas');
             localStorage.setItem(projectKey, JSON.stringify(recipeIdeas));
             console.log('ğŸ’¾ Saved', recipeIdeas.length, 'recipe ideas to project:', projectKey);
           } else {
             // Fallback to global storage
             localStorage.setItem('recipe_ideas', JSON.stringify(recipeIdeas));
             console.log('ğŸ’¾ Saved', recipeIdeas.length, 'recipe ideas to global storage');
           }
         } catch (error) {
           console.error('âŒ Error saving recipe ideas:', error);
         }
       }

       // Handle idea form submission
       function handleIdeaSubmission(event) {
         event.preventDefault();
         
         const formData = new FormData(event.target);
         const ideaData = {
           id: 'idea_' + Date.now(),
           title: formData.get('idea-title') || document.getElementById('idea-title').value,
           description: formData.get('idea-description') || document.getElementById('idea-description').value,
           cuisine: formData.get('idea-cuisine') || document.getElementById('idea-cuisine').value,
           difficulty: formData.get('idea-difficulty') || document.getElementById('idea-difficulty').value,
           ingredients: formData.get('idea-ingredients') || document.getElementById('idea-ingredients').value,
           url: formData.get('idea-url') || document.getElementById('idea-url').value,
           status: 'idea', // idea, in-progress, completed
           createdAt: new Date().toISOString(),
           lastUpdated: new Date().toISOString()
         };

         // Add to ideas array
         recipeIdeas.unshift(ideaData);
         ideasCounter++;
         
         // Save to project-aware storage
         saveRecipeIdeas();
         
         // Update display
         updateIdeasDisplay();
         updateIdeasStats();
         
         // Clear form
         clearIdeaForm();
         
         console.log('âœ… Recipe idea saved:', ideaData);
         alert('Recipe idea saved successfully!');
       }

       // Clear idea form
       function clearIdeaForm() {
         document.getElementById('idea-title').value = '';
         document.getElementById('idea-description').value = '';
         document.getElementById('idea-cuisine').value = '';
         document.getElementById('idea-difficulty').value = '';
         document.getElementById('idea-ingredients').value = '';
         document.getElementById('idea-url').value = '';
       }

       // Update ideas display
       function updateIdeasDisplay() {
         const recentIdeasList = document.getElementById('recent-ideas-list');
         const ideaCount = document.getElementById('idea-count');
         
         if (ideaCount) {
           ideaCount.textContent = ideasCounter;
         }
         
         if (recentIdeasList) {
           const recentIdeas = recipeIdeas.slice(0, 5); // Show last 5 ideas
           
           if (recentIdeas.length === 0) {
             recentIdeasList.innerHTML = '<p class="text-gray-500">No ideas captured yet</p>';
             return;
           }
           
           recentIdeasList.innerHTML = recentIdeas.map(idea => `
             <div class="idea-item">
               <div class="idea-item-title">${idea.title}</div>
               <div class="idea-item-description">${idea.description}</div>
               ${idea.url ? `<div class="idea-item-url"><a href="${idea.url}" target="_blank" class="text-blue-600 hover:text-blue-800">ğŸ”— View Source</a></div>` : ''}
               <div class="idea-item-meta">
                 ${idea.cuisine ? `<span>ğŸŒ ${idea.cuisine}</span>` : ''}
                 ${idea.difficulty ? `<span>ğŸ“Š ${idea.difficulty}</span>` : ''}
                 <span>ğŸ“… ${new Date(idea.createdAt).toLocaleDateString()}</span>
               </div>
               <div class="idea-item-actions">
                 <button onclick="editIdea('${idea.id}')" class="btn btn-sm btn-secondary">âœï¸ Edit</button>
                 <button onclick="createRecipeFromIdea('${idea.id}')" class="btn btn-sm btn-success">ğŸ§ª Create Recipe</button>
                 <button onclick="deleteIdea('${idea.id}')" class="btn btn-sm btn-danger">ğŸ—‘ï¸ Delete</button>
               </div>
             </div>
           `).join('');
         }
       }

       // Update ideas statistics
       function updateIdeasStats() {
         const totalIdeas = document.getElementById('total-ideas');
         const ideasInProgress = document.getElementById('ideas-in-progress');
         const completedRecipes = document.getElementById('completed-recipes');
         
         if (totalIdeas) totalIdeas.textContent = recipeIdeas.length;
         if (ideasInProgress) ideasInProgress.textContent = recipeIdeas.filter(idea => idea.status === 'in-progress').length;
         if (completedRecipes) completedRecipes.textContent = recipeIdeas.filter(idea => idea.status === 'completed').length;
       }

       // Edit idea
       function editIdea(ideaId) {
         const idea = recipeIdeas.find(i => i.id === ideaId);
         if (!idea) return;
         
         // Populate form with idea data
         document.getElementById('idea-title').value = idea.title;
         document.getElementById('idea-description').value = idea.description;
         document.getElementById('idea-cuisine').value = idea.cuisine;
         document.getElementById('idea-difficulty').value = idea.difficulty;
         document.getElementById('idea-ingredients').value = idea.ingredients;
         document.getElementById('idea-url').value = idea.url || '';
         
         // Remove old idea and add updated one
         recipeIdeas = recipeIdeas.filter(i => i.id !== ideaId);
         ideasCounter--;
         
         // Update display
         updateIdeasDisplay();
         updateIdeasStats();
         
         alert('Idea loaded for editing. Make your changes and click "Save Idea" to update.');
       }

       // Delete idea
       function deleteIdea(ideaId) {
         if (confirm('Are you sure you want to delete this recipe idea?')) {
           recipeIdeas = recipeIdeas.filter(i => i.id !== ideaId);
           ideasCounter--;
           
           // Save to project-aware storage
           saveRecipeIdeas();
           updateIdeasDisplay();
           updateIdeasStats();
           
           console.log('ğŸ—‘ï¸ Recipe idea deleted:', ideaId);
         }
       }

       // Create recipe from idea
       function createRecipeFromIdea(ideaId = null) {
         let idea = null;
         
         if (ideaId) {
           idea = recipeIdeas.find(i => i.id === ideaId);
         } else {
           // Get current form data
           const title = document.getElementById('idea-title').value;
           const description = document.getElementById('idea-description').value;
           
           if (!title.trim()) {
             alert('Please enter a recipe idea title first.');
             return;
           }
           
           idea = {
             title: title,
             description: description,
             cuisine: document.getElementById('idea-cuisine').value,
             difficulty: document.getElementById('idea-difficulty').value,
             ingredients: document.getElementById('idea-ingredients').value,
             url: document.getElementById('idea-url').value
           };
         }
         
         if (!idea) return;
         
         // Create recipe data
         const recipeData = {
           title: idea.title,
           description: idea.description,
           cuisine: idea.cuisine,
           difficulty: idea.difficulty,
           url: idea.url,
           status: 'in-progress',
           source: 'idea',
           ideaId: ideaId,
           createdAt: new Date().toISOString()
         };
         
         // Save recipe to project-aware storage for the developer page
         let existingRecipes = [];
         
         if (window.projectManager && window.projectManager.getCurrentProject()) {
           // Try to load from project-specific storage
           const projectKey = window.projectManager.getProjectStorageKey('recipes_in_progress');
           const storedRecipes = localStorage.getItem(projectKey);
           if (storedRecipes) {
             existingRecipes = JSON.parse(storedRecipes);
           }
         } else {
           // Fallback to global storage
           existingRecipes = JSON.parse(localStorage.getItem('recipes_in_progress') || '[]');
         }
         
         existingRecipes.push(recipeData);
         
         // Save back to project-aware storage
         if (window.projectManager && window.projectManager.getCurrentProject()) {
           const projectKey = window.projectManager.getProjectStorageKey('recipes_in_progress');
           localStorage.setItem(projectKey, JSON.stringify(existingRecipes));
           console.log('ğŸ’¾ Saved in-progress recipe to project:', projectKey);
         } else {
           localStorage.setItem('recipes_in_progress', JSON.stringify(existingRecipes));
           console.log('ğŸ’¾ Saved in-progress recipe to global storage');
         }
         
         // Update idea status if it was from an existing idea
         if (ideaId) {
           const ideaIndex = recipeIdeas.findIndex(i => i.id === ideaId);
           if (ideaIndex !== -1) {
             recipeIdeas[ideaIndex].status = 'in-progress';
             recipeIdeas[ideaIndex].lastUpdated = new Date().toISOString();
             // Save to project-aware storage
             saveRecipeIdeas();
             updateIdeasDisplay();
             updateIdeasStats();
           }
         }
         
         // Redirect to recipe developer page
         window.open('recipe-developer.html', '_blank');
         
         console.log('ğŸ§ª Recipe created from idea:', recipeData);
         alert('Recipe created successfully! Redirecting to Recipe Developer...');
       }

       // View all ideas
       function viewAllIdeas() {
         const ideasList = recipeIdeas.map(idea => `
           ${idea.title} - ${idea.status} - ${new Date(idea.createdAt).toLocaleDateString()}
           ${idea.url ? `\n   URL: ${idea.url}` : ''}
         `).join('\n');
         
         alert('All Recipe Ideas:\n\n' + ideasList);
       }

       // Search ideas
       function searchIdeas() {
         const searchTerm = document.getElementById('ideas-search').value.toLowerCase();
         const resultsContainer = document.getElementById('ideas-search-results');
         
         if (!searchTerm.trim()) {
           resultsContainer.innerHTML = '<p class="text-gray-500">Enter a search term to find ideas</p>';
           return;
         }
         
         const matchingIdeas = recipeIdeas.filter(idea => 
           idea.title.toLowerCase().includes(searchTerm) ||
           idea.description.toLowerCase().includes(searchTerm) ||
           idea.cuisine.toLowerCase().includes(searchTerm) ||
           idea.ingredients.toLowerCase().includes(searchTerm)
         );
         
         if (matchingIdeas.length === 0) {
           resultsContainer.innerHTML = '<p class="text-gray-500">No ideas found matching your search</p>';
           return;
         }
         
         resultsContainer.innerHTML = matchingIdeas.map(idea => `
           <div class="idea-item">
             <div class="idea-item-title">${idea.title}</div>
             <div class="idea-item-description">${idea.description}</div>
             ${idea.url ? `<div class="idea-item-url"><a href="${idea.url}" target="_blank" class="text-blue-600 hover:text-blue-800">ğŸ”— View Source</a></div>` : ''}
             <div class="idea-item-meta">
               ${idea.cuisine ? `<span>ğŸŒ ${idea.cuisine}</span>` : ''}
               ${idea.difficulty ? `<span>ğŸ“Š ${idea.difficulty}</span>` : ''}
               <span>ğŸ“… ${new Date(idea.createdAt).toLocaleDateString()}</span>
               <span>ğŸ“Š ${idea.status}</span>
             </div>
           </div>
         `).join('');
       }

       // Initialize ideas system when page loads
       document.addEventListener('DOMContentLoaded', function() {
         // ... existing initialization code ...
         
         // Initialize ideas system
         initializeIdeasSystem();
       });

       // Initialize Main Iterum App with Forced User Selection
       document.addEventListener('DOMContentLoaded', async function() {
         console.log('ğŸš€ Initializing Iterum App with Forced User Selection...');
         
         // Wait for all systems to load
         await new Promise(resolve => setTimeout(resolve, 1000));
         
         // Initialize the main app
         if (window.IterumApp) {
           try {
             console.log('ğŸ”§ Starting main app initialization...');
             await window.IterumApp.init();
             console.log('âœ… Main app initialization complete');
           } catch (error) {
             console.error('âŒ Main app initialization failed:', error);
           }
         } else {
           console.error('âŒ IterumApp not found - authentication system may not work properly');
         }
         
         // Show loading overlay until authentication is complete
         const loadingOverlay = document.getElementById('loading-overlay');
         if (loadingOverlay) {
           loadingOverlay.style.display = 'flex';
           loadingOverlay.style.opacity = '1';
           console.log('ğŸ”’ Showing authentication overlay...');
         }
       });

       // Manual refresh function for debugging
       function refreshRecipeIdeas() {
         console.log('ğŸ”„ Manually refreshing recipe ideas...');
         loadRecipeIdeas();
         updateIdeasDisplay();
         updateIdeasStats();
       }

       // Make refresh function globally available for debugging
       window.refreshRecipeIdeas = refreshRecipeIdeas;
       
       // Debug function to check storage state
       function debugRecipeIdeasStorage() {
         console.log('ğŸ” === RECIPE IDEAS STORAGE DEBUG ===');
         console.log('ğŸ” Current recipeIdeas array:', recipeIdeas);
         console.log('ğŸ” Ideas counter:', ideasCounter);
         
         if (window.projectManager) {
           const currentProject = window.projectManager.getCurrentProject();
           console.log('ğŸ” Current project:', currentProject);
           
           if (currentProject) {
             const projectKey = window.projectManager.getProjectStorageKey('recipe_ideas');
             console.log('ğŸ” Project storage key:', projectKey);
             
             const storedIdeas = localStorage.getItem(projectKey);
             console.log('ğŸ” Stored ideas in project:', storedIdeas ? JSON.parse(storedIdeas) : 'null');
           }
         }
         
         const globalIdeas = localStorage.getItem('recipe_ideas');
         console.log('ğŸ” Global storage ideas:', globalIdeas ? JSON.parse(globalIdeas) : 'null');
         
         console.log('ğŸ” === END DEBUG ===');
       }
       
       // Make debug function globally available
       window.debugRecipeIdeasStorage = debugRecipeIdeasStorage;
       
       // Test function to create a sample idea and verify storage
       function testRecipeIdeasStorage() {
         console.log('ğŸ§ª Testing recipe ideas storage...');
         
         // Create a test idea
         const testIdea = {
           id: 'test_idea_' + Date.now(),
           title: 'Test Recipe Idea',
           description: 'This is a test recipe idea to verify storage is working',
           cuisine: 'Test Cuisine',
           difficulty: 'easy',
           ingredients: 'Test ingredients',
           url: 'https://example.com/test-recipe',
           status: 'idea',
           createdAt: new Date().toISOString(),
           lastUpdated: new Date().toISOString()
         };
         
         // Add to ideas array
         recipeIdeas.unshift(testIdea);
         ideasCounter++;
         
         // Save to storage
         saveRecipeIdeas();
         
         // Update display
         updateIdeasDisplay();
         updateIdeasStats();
         
         console.log('âœ… Test idea created and saved');
         console.log('ğŸ§ª Current ideas count:', ideasCounter);
         
         // Debug storage state
         debugRecipeIdeasStorage();
         
         alert('Test idea created! Check console for debug info.');
       }
       
       // Make test function globally available
       window.testRecipeIdeasStorage = testRecipeIdeasStorage;

       // Function to fetch recipe data from URL
       async function fetchRecipeFromURL() {
         const urlInput = document.getElementById('idea-url');
         const statusDiv = document.getElementById('url-fetch-status');
         const fetchBtn = document.getElementById('fetch-recipe-btn');
         const url = urlInput.value.trim();
         
         if (!url) {
           statusDiv.textContent = 'Please enter a URL first';
           statusDiv.className = 'url-fetch-status error';
           return;
         }
         
         if (!url.startsWith('http://') && !url.startsWith('https://')) {
           statusDiv.textContent = 'Please enter a valid URL starting with http:// or https://';
           statusDiv.className = 'url-fetch-status error';
           return;
         }
         
         try {
           statusDiv.textContent = 'ğŸ” Fetching recipe data...';
           statusDiv.className = 'url-fetch-status loading';
           
           // Update button state
           if (fetchBtn) {
             fetchBtn.disabled = true;
             fetchBtn.innerHTML = 'â³ Fetching...';
           }
           
           // Use a CORS proxy to fetch the URL content
           const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
           const response = await fetch(proxyUrl);
           
           if (!response.ok) {
             throw new Error(`HTTP error! status: ${response.status}`);
           }
           
           const data = await response.json();
           
           if (!data.contents) {
             throw new Error('No content received from URL');
           }
           
           // Parse the HTML content
           const parser = new DOMParser();
           const doc = parser.parseFromString(data.contents, 'text/html');
           
           // Extract recipe information using common selectors
           const recipeData = extractRecipeData(doc, url);
           
           if (recipeData.title) {
             // Populate the form fields with extracted data
             populateFormWithRecipeData(recipeData);
             
             statusDiv.textContent = 'âœ… Recipe data fetched successfully!';
             statusDiv.className = 'url-fetch-status success';
           } else {
             statusDiv.textContent = 'âš ï¸ No recipe data found. You may need to enter details manually.';
             statusDiv.className = 'url-fetch-status error';
           }
           
         } catch (error) {
           console.error('Error fetching recipe from URL:', error);
           statusDiv.textContent = `âŒ Error: ${error.message}`;
           statusDiv.className = 'url-fetch-status error';
         } finally {
           // Reset button state
           if (fetchBtn) {
             fetchBtn.disabled = false;
             fetchBtn.innerHTML = 'ğŸ”— Fetch Recipe';
           }
         }
       }

       // Function to extract recipe data from HTML
       function extractRecipeData(doc, url) {
         const recipeData = {
           title: '',
           description: '',
           ingredients: '',
           cuisine: '',
           difficulty: ''
         };
         
         // Try to extract title from various common selectors
         const titleSelectors = [
           'h1[class*="recipe"]',
           'h1[class*="title"]',
           'h1[class*="dish"]',
           'h1[class*="food"]',
           'h1',
           'title'
         ];
         
         for (const selector of titleSelectors) {
           const element = doc.querySelector(selector);
           if (element && element.textContent.trim()) {
             recipeData.title = element.textContent.trim();
             break;
           }
         }
         
         // Try to extract description
         const descSelectors = [
           'meta[name="description"]',
           'meta[property="og:description"]',
           'p[class*="description"]',
           'p[class*="summary"]',
           'div[class*="description"]'
         ];
         
         for (const selector of descSelectors) {
           const element = doc.querySelector(selector);
           if (element) {
             const content = element.getAttribute('content') || element.textContent.trim();
             if (content) {
               recipeData.description = content;
               break;
             }
           }
         }
         
         // Try to extract ingredients
         const ingredientSelectors = [
           'ul[class*="ingredient"]',
           'ol[class*="ingredient"]',
           'div[class*="ingredient"]',
           'li[class*="ingredient"]'
         ];
         
         for (const selector of ingredientSelectors) {
           const elements = doc.querySelectorAll(selector);
           if (elements.length > 0) {
             const ingredients = Array.from(elements).map(el => el.textContent.trim()).filter(text => text.length > 0);
             if (ingredients.length > 0) {
               recipeData.ingredients = ingredients.join('\n');
               break;
             }
           }
         }
         
         // Try to detect cuisine type from content
         const content = doc.body.textContent.toLowerCase();
         const cuisineKeywords = {
           'italian': ['italian', 'pasta', 'pizza', 'risotto', 'bruschetta'],
           'mexican': ['mexican', 'taco', 'burrito', 'enchilada', 'guacamole'],
           'asian': ['asian', 'chinese', 'japanese', 'thai', 'vietnamese', 'sushi', 'curry'],
           'mediterranean': ['mediterranean', 'greek', 'spanish', 'lebanese', 'hummus'],
           'american': ['american', 'burger', 'bbq', 'southern', 'cajun'],
           'french': ['french', 'bistro', 'boulangerie', 'croissant'],
           'indian': ['indian', 'curry', 'masala', 'naan', 'tandoori']
         };
         
         for (const [cuisine, keywords] of Object.entries(cuisineKeywords)) {
           if (keywords.some(keyword => content.includes(keyword))) {
             recipeData.cuisine = cuisine;
             break;
           }
         }
         
         // Try to detect difficulty from content
         const difficultyKeywords = {
           'easy': ['easy', 'simple', 'quick', 'basic'],
           'medium': ['medium', 'moderate', 'intermediate'],
           'hard': ['hard', 'difficult', 'advanced', 'complex', 'challenging']
         };
         
         for (const [difficulty, keywords] of Object.entries(difficultyKeywords)) {
           if (keywords.some(keyword => content.includes(keyword))) {
             recipeData.difficulty = difficulty;
             break;
           }
         }
         
         return recipeData;
       }

       // Function to populate form with fetched recipe data
       function populateFormWithRecipeData(recipeData) {
         if (recipeData.title) {
           document.getElementById('idea-title').value = recipeData.title;
         }
         
         if (recipeData.description) {
           document.getElementById('idea-description').value = recipeData.description;
         }
         
         if (recipeData.ingredients) {
           document.getElementById('idea-ingredients').value = recipeData.ingredients;
         }
         
         if (recipeData.cuisine) {
           document.getElementById('idea-cuisine').value = recipeData.cuisine;
         }
         
         if (recipeData.difficulty) {
           document.getElementById('idea-difficulty').value = recipeData.difficulty;
         }
         
         console.log('âœ… Form populated with recipe data:', recipeData);
       }

      // Make fetch function globally available
      window.fetchRecipeFromURL = fetchRecipeFromURL;
    </script>

    <!-- Initialize Unified Authentication System -->
    <script>
      // Initialize authentication system when DOM is ready
      document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸš€ DOM loaded, initializing authentication system...');
        
        // Show content immediately to prevent unresponsive state
        document.body.style.display = 'block';
        
        // Hide loading indicator
        const loadingIndicator = document.getElementById('simple-loading');
        if (loadingIndicator) {
          loadingIndicator.style.display = 'none';
        }
        
        // Check for emergency access bypass
        const emergencyAccess = sessionStorage.getItem('emergency_access');
        const bypassAuth = sessionStorage.getItem('bypass_auth');
        
        if (emergencyAccess === 'true' || bypassAuth === 'true') {
          console.log('ğŸš¨ EMERGENCY ACCESS DETECTED - Bypassing problematic authentication');
          // Clear the bypass flag
          sessionStorage.removeItem('emergency_access');
          sessionStorage.removeItem('bypass_auth');
          // Show content and skip authentication
          document.body.style.display = 'block';
          console.log('âœ… Emergency access granted - app loaded without authentication system');
          return;
        }
        
        // Wait a moment for all scripts to load
        setTimeout(() => {
          try {
            if (typeof UnifiedAuthSystem !== 'undefined') {
              console.log('âœ… UnifiedAuthSystem class found, creating instance...');
              window.unifiedAuthSystem = new UnifiedAuthSystem();
              window.unifiedAuth = window.unifiedAuthSystem; // Alias for onclick handlers
              console.log('âœ… Authentication system initialized');
            } else {
              console.error('âŒ UnifiedAuthSystem class not found');
              // Fallback: show content anyway
              document.body.style.display = 'block';
            }
          } catch (error) {
            console.error('âŒ CRITICAL ERROR initializing authentication:', error);
            // Emergency fallback: show content and redirect to emergency page
            document.body.style.display = 'block';
            alert('Authentication system encountered an error. Redirecting to emergency access page...');
            setTimeout(() => {
              window.location.href = 'emergency_fix_index.html';
            }, 2000);
          }
          
          // Initialize page protection if available
          if (typeof PageProtection !== 'undefined') {
            console.log('âœ… PageProtection class found, creating instance...');
            window.pageProtection = new PageProtection();
            console.log('âœ… Page protection system initialized');
          } else {
            console.warn('âš ï¸ PageProtection class not found');
          }
        }, 100);
        
        // Fallback timeout to ensure page is never unresponsive
        setTimeout(() => {
          if (document.body.style.display === 'none') {
            console.warn('âš ï¸ Fallback: Showing content after timeout');
            document.body.style.display = 'block';
          }
        }, 2000);
      });
    </script>
</body>
</html>