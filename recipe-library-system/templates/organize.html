{% extends "base.html" %}

{% block title %}Organize Recipes - Recipe Manager{% endblock %}
{% block page_title %}Organize Recipes{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card border-0 shadow-sm" style="border-radius: 1rem;">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <div class="icon-large mb-3" style="font-size: 4rem; color: var(--primary-color);">
                        <i class="bi bi-folder-plus"></i>
                    </div>
                    <h3>Organize Your Recipes</h3>
                    <p class="text-muted">Import recipes from any folder into your library</p>
                </div>
                
                <form id="organizeForm">
                    <div class="mb-4">
                        <label class="form-label fw-medium">Folder Path</label>
                        <input type="text" class="form-control form-control-lg" 
                               id="folderPath" placeholder="C:\Your\Recipe\Folder" required>
                        <small class="text-muted">Enter the full path to your recipe folder</small>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-medium">Mode</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="mode" 
                                   id="modeCopy" value="copy" checked>
                            <label class="form-check-label" for="modeCopy">
                                <strong>Copy</strong> - Keep original files (safer)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="mode" 
                                   id="modeMove" value="move">
                            <label class="form-check-label" for="modeMove">
                                <strong>Move</strong> - Remove from original location
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-lg w-100" id="organizeBtn">
                        <i class="bi bi-folder-plus me-2"></i>
                        Start Organizing
                    </button>
                </form>
                
                <div id="progress" class="mt-4" style="display: none;">
                    <div class="alert alert-info">
                        <i class="bi bi-hourglass-split me-2"></i>
                        <span id="progressText">Processing...</span>
                    </div>
                </div>
                
                <div id="results" class="mt-4" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('organizeForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const folderPath = document.getElementById('folderPath').value;
    const mode = document.querySelector('input[name="mode"]:checked').value;
    const btn = document.getElementById('organizeBtn');
    const progress = document.getElementById('progress');
    const results = document.getElementById('results');
    
    btn.disabled = true;
    progress.style.display = 'block';
    results.style.display = 'none';
    
    fetch('/api/organize', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({folder_path: folderPath, mode: mode})
    })
    .then(r => r.json())
    .then(data => {
        progress.style.display = 'none';
        results.style.display = 'block';
        
        if (data.success) {
            results.innerHTML = `
                <div class="alert alert-success">
                    <h5><i class="bi bi-check-circle-fill me-2"></i>Success!</h5>
                    <p class="mb-0">Organized ${data.count} recipes into your library.</p>
                </div>
            `;
        } else {
            results.innerHTML = `
                <div class="alert alert-danger">
                    <h5><i class="bi bi-x-circle-fill me-2"></i>Error</h5>
                    <p class="mb-0">${data.error}</p>
                </div>
            `;
        }
        
        btn.disabled = false;
    })
    .catch(err => {
        progress.style.display = 'none';
        results.style.display = 'block';
        results.innerHTML = `
            <div class="alert alert-danger">
                <h5><i class="bi bi-x-circle-fill me-2"></i>Error</h5>
                <p class="mb-0">${err.message}</p>
            </div>
        `;
        btn.disabled = false;
    });
});
</script>
{% endblock %}


