<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management Test - Iterum</title>
    <link rel="stylesheet" href="assets/css/iterum-design-system.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f6fbe7 0%, #eafcd7 100%);
            min-height: 100vh;
            margin: 0;
            padding: 2rem;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 0.5rem;
            border-left: 4px solid #3b82f6;
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.2s;
        }
        
        .test-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .test-button.success {
            background: #10b981;
        }
        
        .test-button.success:hover {
            background: #059669;
        }
        
        .test-button.danger {
            background: #ef4444;
        }
        
        .test-button.danger:hover {
            background: #dc2626;
        }
        
        .status-display {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .user-info {
            background: #dbeafe;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border-left: 4px solid #3b82f6;
        }
        
        .log-container {
            background: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª User Management System Test</h1>
            <p>Test the user add and change functionality on the main screen</p>
        </div>

        <!-- Current User Status -->
        <div class="test-section">
            <h3>ğŸ‘¤ Current User Status</h3>
            <div id="current-user-display" class="user-info">
                Loading user information...
            </div>
            <button onclick="refreshUserInfo()" class="test-button">ğŸ”„ Refresh User Info</button>
        </div>

        <!-- User Management Tests -->
        <div class="test-section">
            <h3>ğŸ­ User Management Tests</h3>
            <div class="test-buttons">
                <button onclick="testCreateUser()" class="test-button success">â• Create New User</button>
                <button onclick="testUserModal()" class="test-button">ğŸ‘¥ User Management Modal</button>
                <button onclick="testSettings()" class="test-button">âš™ï¸ User Settings</button>
                <button onclick="testQuickSwitch()" class="test-button">ğŸ”„ Quick User Switch</button>
            </div>
        </div>

        <!-- User List -->
        <div class="test-section">
            <h3>ğŸ“š All Users</h3>
            <div id="users-list" class="status-display">
                Loading users...
            </div>
            <button onclick="refreshUsersList()" class="test-button">ğŸ”„ Refresh Users</button>
        </div>

        <!-- Data Management Tests -->
        <div class="test-section">
            <h3>ğŸ’¾ Data Management Tests</h3>
            <div class="test-buttons">
                <button onclick="testExportUser()" class="test-button success">ğŸ“¤ Export User Data</button>
                <button onclick="testImportUser()" class="test-button">ğŸ“¥ Import User Data</button>
                <button onclick="testDeleteUser()" class="test-button danger">ğŸ—‘ï¸ Delete Current User</button>
            </div>
        </div>

        <!-- System Logs -->
        <div class="test-section">
            <h3>ğŸ“‹ System Logs</h3>
            <div id="system-logs" class="log-container">
                System logs will appear here...
            </div>
            <button onclick="clearLogs()" class="test-button">ğŸ—‘ï¸ Clear Logs</button>
        </div>

        <!-- Test Results -->
        <div class="test-section">
            <h3>âœ… Test Results</h3>
            <div id="test-results" class="status-display">
                No tests run yet...
            </div>
        </div>
    </div>

    <!-- Load User Management System -->
    <script src="assets/js/simple-user-system.js"></script>
    
    <script>
        // Test logging system
        const logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logs.push(logEntry);
            
            const logContainer = document.getElementById('system-logs');
            if (logContainer) {
                logContainer.textContent = logs.join('\n');
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            
            console.log(logEntry);
        }

        // Test functions
        function testCreateUser() {
            log('Testing user creation...', 'info');
            try {
                if (window.userSystem) {
                    window.userSystem.showSimpleUserModal();
                    log('âœ… Simple user creation modal displayed', 'success');
                    addTestResult('Create User Modal', 'PASSED', 'Modal displayed successfully');
                } else {
                    log('âŒ User system not available', 'error');
                    addTestResult('Create User Modal', 'FAILED', 'User system not loaded');
                }
            } catch (error) {
                log(`âŒ Error testing user creation: ${error.message}`, 'error');
                addTestResult('Create User Modal', 'FAILED', error.message);
            }
        }

        function testUserModal() {
            log('Testing user management modal...', 'info');
            try {
                if (window.userSystem) {
                    window.userSystem.showUserModal();
                    log('âœ… User management modal displayed', 'success');
                    addTestResult('User Management Modal', 'PASSED', 'Modal displayed successfully');
                } else {
                    log('âŒ User system not available', 'error');
                    addTestResult('User Management Modal', 'FAILED', 'User system not loaded');
                }
            } catch (error) {
                log(`âŒ Error testing user modal: ${error.message}`, 'error');
                addTestResult('User Management Modal', 'FAILED', error.message);
            }
        }

        function testSettings() {
            log('Testing user settings...', 'info');
            try {
                if (window.userSystem) {
                    window.userSystem.showSettings();
                    log('âœ… User settings modal displayed', 'success');
                    addTestResult('User Settings', 'PASSED', 'Settings modal displayed successfully');
                } else {
                    log('âŒ User system not available', 'error');
                    addTestResult('User Settings', 'FAILED', 'User system not loaded');
                }
            } catch (error) {
                log(`âŒ Error testing user settings: ${error.message}`, 'error');
                addTestResult('User Settings', 'FAILED', error.message);
            }
        }

        function testQuickSwitch() {
            log('Testing quick user switch...', 'info');
            try {
                if (window.userSystem) {
                    const previousUser = window.userSystem.getCurrentUser();
                    window.userSystem.quickSwitch();
                    const newUser = window.userSystem.getCurrentUser();
                    
                    if (previousUser.id !== newUser.id) {
                        log(`âœ… Quick switch successful: ${previousUser.name} â†’ ${newUser.name}`, 'success');
                        addTestResult('Quick User Switch', 'PASSED', `Switched from ${previousUser.name} to ${newUser.name}`);
                    } else {
                        log('âš ï¸ Quick switch completed but user remained the same', 'warning');
                        addTestResult('Quick User Switch', 'PASSED', 'Switch completed (only one user available)');
                    }
                    
                    refreshUserInfo();
                } else {
                    log('âŒ User system not available', 'error');
                    addTestResult('Quick User Switch', 'FAILED', 'User system not loaded');
                }
            } catch (error) {
                log(`âŒ Error testing quick switch: ${error.message}`, 'error');
                addTestResult('Quick User Switch', 'FAILED', error.message);
            }
        }

        function testExportUser() {
            log('Testing user data export...', 'info');
            try {
                if (window.userSystem) {
                    window.userSystem.exportUserData();
                    log('âœ… User data export initiated', 'success');
                    addTestResult('Export User Data', 'PASSED', 'Export function called successfully');
                } else {
                    log('âŒ User system not available', 'error');
                    addTestResult('Export User Data', 'FAILED', 'User system not loaded');
                }
            } catch (error) {
                log(`âŒ Error testing export: ${error.message}`, 'error');
                addTestResult('Export User Data', 'FAILED', error.message);
            }
        }

        function testImportUser() {
            log('Testing user data import...', 'info');
            try {
                if (window.userSystem) {
                    window.userSystem.importUserData();
                    log('âœ… User data import initiated', 'success');
                    addTestResult('Import User Data', 'PASSED', 'Import function called successfully');
                } else {
                    log('âŒ User system not available', 'error');
                    addTestResult('Import User Data', 'FAILED', 'User system not loaded');
                }
            } catch (error) {
                log(`âŒ Error testing import: ${error.message}`, 'error');
                addTestResult('Import User Data', 'FAILED', error.message);
            }
        }

        function testDeleteUser() {
            log('Testing user deletion...', 'info');
            try {
                if (window.userSystem) {
                    const currentUser = window.userSystem.getCurrentUser();
                    if (window.userSystem.users.length > 1) {
                        if (confirm(`Are you sure you want to delete user "${currentUser.name}"? This is a test.`)) {
                            window.userSystem.deleteCurrentUser();
                            log('âœ… User deletion test completed', 'success');
                            addTestResult('Delete User', 'PASSED', 'User deletion function called successfully');
                            refreshUserInfo();
                            refreshUsersList();
                        } else {
                            log('âš ï¸ User deletion cancelled by user', 'warning');
                            addTestResult('Delete User', 'CANCELLED', 'User cancelled the deletion');
                        }
                    } else {
                        log('âš ï¸ Cannot delete user - only one user available', 'warning');
                        addTestResult('Delete User', 'SKIPPED', 'Only one user available, deletion skipped');
                    }
                } else {
                    log('âŒ User system not available', 'error');
                    addTestResult('Delete User', 'FAILED', 'User system not loaded');
                }
            } catch (error) {
                log(`âŒ Error testing user deletion: ${error.message}`, 'error');
                addTestResult('Delete User', 'FAILED', error.message);
            }
        }

        function refreshUserInfo() {
            if (window.userSystem) {
                const currentUser = window.userSystem.getCurrentUser();
                const userDisplay = document.getElementById('current-user-display');
                if (userDisplay) {
                    userDisplay.innerHTML = `
                        <strong>Name:</strong> ${currentUser?.name || 'Unknown'}<br>
                        <strong>Role:</strong> ${currentUser?.role || 'Unknown'}<br>
                        <strong>Avatar:</strong> ${currentUser?.avatar || 'ğŸ‘¤'}<br>
                        <strong>ID:</strong> ${currentUser?.id || 'Unknown'}<br>
                        <strong>Created:</strong> ${currentUser?.createdAt ? new Date(currentUser.createdAt).toLocaleDateString() : 'Unknown'}
                    `;
                }
                log('âœ… User info refreshed', 'info');
            }
        }

        function refreshUsersList() {
            if (window.userSystem) {
                const users = window.userSystem.getAllUsers();
                const usersList = document.getElementById('users-list');
                if (usersList) {
                    usersList.textContent = JSON.stringify(users, null, 2);
                }
                log(`âœ… Users list refreshed (${users.length} users)`, 'info');
            }
        }

        function addTestResult(testName, status, message) {
            const resultsContainer = document.getElementById('test-results');
            if (resultsContainer) {
                const timestamp = new Date().toLocaleTimeString();
                const resultEntry = `[${timestamp}] ${testName}: ${status} - ${message}`;
                const currentResults = resultsContainer.textContent;
                resultsContainer.textContent = currentResults + '\n' + resultEntry;
            }
        }

        function clearLogs() {
            logs.length = 0;
            const logContainer = document.getElementById('system-logs');
            if (logContainer) {
                logContainer.textContent = 'Logs cleared...';
            }
            log('Logs cleared by user', 'info');
        }

        // Initialize test page
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ§ª User Management Test Page Started', 'info');
            
            // Wait for user system to load
            setTimeout(() => {
                if (window.userSystem) {
                    log('âœ… User system loaded successfully', 'success');
                    refreshUserInfo();
                    refreshUsersList();
                    
                    // Test basic functionality
                    const currentUser = window.userSystem.getCurrentUser();
                    if (currentUser) {
                        log(`ğŸ‘¤ Current user: ${currentUser.name}`, 'info');
                        addTestResult('System Initialization', 'PASSED', 'User system loaded and initialized');
                    } else {
                        log('âš ï¸ No current user found', 'warning');
                        addTestResult('System Initialization', 'WARNING', 'No current user found');
                    }
                } else {
                    log('âŒ User system failed to load', 'error');
                    addTestResult('System Initialization', 'FAILED', 'User system not loaded');
                }
            }, 1000);
        });

        // Listen for user change events
        window.addEventListener('userChanged', function(event) {
            log(`ğŸ‘¤ User changed to: ${event.detail.user.name}`, 'info');
            refreshUserInfo();
            refreshUsersList();
        });
    </script>
</body>
</html>
