<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Persistence Test - Iterum App</title>
    <link rel="stylesheet" href="assets/css/iterum-design-system.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="iterum-header">
        <div class="header-container">
            <!-- Logo -->
            <a href="index.html" class="header-logo">
                <div class="header-logo-icon">üçÉ</div>
                <div class="header-logo-text">
                    <div class="header-logo-title">Iterum R&D</div>
                    <div class="header-logo-subtitle">Chef Notebook</div>
                </div>
            </a>

            <!-- Navigation -->
            <nav class="header-navigation">
                <a href="index.html" class="header-nav-item">
                    <span class="nav-icon">üè†</span>
                    <span>Dashboard</span>
                </a>
                <a href="vendor-management.html" class="header-nav-item">
                    <span class="nav-icon">üè™</span>
                    <span>Vendors</span>
                </a>
            </nav>

            <!-- Project Selector -->
            <select id="header-project-selector" class="header-project-selector">
                <option value="">Select Project...</option>
            </select>

            <!-- User Section -->
            <div class="header-user-section">
                <div class="header-user-tab">
                    <div class="header-user-avatar">üë§</div>
                    <div class="header-user-info">
                        <div class="header-user-name">Test User</div>
                        <div class="header-user-role">Chef</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Project Persistence Test</h1>
            
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Current Project Status</h2>
                <div id="project-status" class="space-y-2">
                    <p><strong>Current Project:</strong> <span id="current-project-name">Loading...</span></p>
                    <p><strong>Project ID:</strong> <span id="current-project-id">Loading...</span></p>
                    <p><strong>LocalStorage Key:</strong> <span id="localstorage-key">Loading...</span></p>
                    <p><strong>LocalStorage Value:</strong> <span id="localstorage-value">Loading...</span></p>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Test Actions</h2>
                <div class="space-y-4">
                    <button onclick="testProjectSelection()" class="btn btn-primary">
                        Test Project Selection
                    </button>
                    <button onclick="navigateToVendors()" class="btn btn-secondary">
                        Navigate to Vendors Page
                    </button>
                    <button onclick="refreshProjectStatus()" class="btn btn-secondary">
                        Refresh Project Status
                    </button>
                    <button onclick="clearProjectSelection()" class="btn btn-secondary">
                        Clear Project Selection
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Test Results</h2>
                <div id="test-results" class="space-y-2 text-sm">
                    <p>No tests run yet.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="assets/js/project-management-system.js"></script>
    <script>
        // Test functions
        function testProjectSelection() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p>Running project selection test...</p>';
            
            try {
                if (window.projectManager) {
                    // Test setting a project
                    const testProject = window.projectManager.projects[0];
                    if (testProject) {
                        window.projectManager.setCurrentProject(testProject.id);
                        results.innerHTML += `<p class="text-green-600">‚úÖ Set current project to: ${testProject.name}</p>`;
                        refreshProjectStatus();
                    } else {
                        results.innerHTML += `<p class="text-red-600">‚ùå No projects available for testing</p>`;
                    }
                } else {
                    results.innerHTML += `<p class="text-red-600">‚ùå Project manager not available</p>`;
                }
            } catch (error) {
                results.innerHTML += `<p class="text-red-600">‚ùå Error: ${error.message}</p>`;
            }
        }

        function navigateToVendors() {
            const results = document.getElementById('test-results');
            results.innerHTML += `<p class="text-blue-600">üîÑ Navigating to vendors page...</p>`;
            setTimeout(() => {
                window.location.href = 'vendor-management.html';
            }, 1000);
        }

        function refreshProjectStatus() {
            const currentProjectName = document.getElementById('current-project-name');
            const currentProjectId = document.getElementById('current-project-id');
            const localStorageKey = document.getElementById('localstorage-key');
            const localStorageValue = document.getElementById('localstorage-value');
            
            if (window.projectManager && window.projectManager.currentProject) {
                currentProjectName.textContent = window.projectManager.currentProject.name;
                currentProjectId.textContent = window.projectManager.currentProject.id;
            } else {
                currentProjectName.textContent = 'None';
                currentProjectId.textContent = 'None';
            }
            
            localStorageKey.textContent = 'iterum_current_project';
            localStorageValue.textContent = localStorage.getItem('iterum_current_project') || 'None';
        }

        function clearProjectSelection() {
            const results = document.getElementById('test-results');
            try {
                localStorage.removeItem('iterum_current_project');
                if (window.projectManager) {
                    window.projectManager.currentProject = null;
                    window.projectManager.updateProjectUI();
                }
                results.innerHTML += `<p class="text-green-600">‚úÖ Project selection cleared</p>`;
                refreshProjectStatus();
            } catch (error) {
                results.innerHTML += `<p class="text-red-600">‚ùå Error clearing project: ${error.message}</p>`;
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Project Persistence Test Page loaded');
            
            // Wait for project manager to be ready
            setTimeout(() => {
                if (window.projectManager) {
                    refreshProjectStatus();
                    console.log('‚úÖ Project status refreshed');
                } else {
                    console.warn('‚ö†Ô∏è Project manager not available');
                }
            }, 500);
        });
    </script>
</body>
</html>
