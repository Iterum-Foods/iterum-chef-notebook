<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price List Upload - Iterum R&D</title>
    
    <!-- Auth System -->
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/auth-manager.js"></script>
    <script src="assets/js/auth-api-helper.js"></script>
    <script src="assets/js/auth-diagnostics.js"></script>
    <script src="assets/js/auth_guard.js"></script>
    <script src="assets/js/header-user-display.js"></script>
    <script src="assets/js/profile-editor.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/unified-header.css">
    <link rel="stylesheet" href="assets/css/page-layouts.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            background: linear-gradient(135deg, #4a7c2c 0%, #2d5a1a 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(74, 124, 44, 0.3);
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .page-header p {
            font-size: 1.125rem;
            opacity: 0.95;
        }

        .upload-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .upload-zone {
            border: 3px dashed #cbd5e1;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .upload-zone:hover {
            border-color: #4a7c2c;
            background: #f0fdf4;
        }

        .upload-zone.dragover {
            border-color: #4a7c2c;
            background: #dcfce7;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .upload-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .upload-subtitle {
            color: #64748b;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a7c2c 0%, #2d5a1a 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(74, 124, 44, 0.3);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #1e293b;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .file-input {
            display: none;
        }

        .matching-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: none;
        }

        .matching-section.active {
            display: block;
        }

        .match-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid;
        }

        .stat-card.matched {
            background: #dcfce7;
            border-color: #16a34a;
        }

        .stat-card.unmatched {
            background: #fef3c7;
            border-color: #f59e0b;
        }

        .stat-card.total {
            background: #dbeafe;
            border-color: #3b82f6;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .match-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .match-table th {
            background: #f8fafc;
            padding: 12px 16px;
            text-align: left;
            font-weight: 700;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
        }

        .match-table td {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .match-table tr:hover {
            background: #f8fafc;
        }

        .match-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .match-status.matched {
            background: #dcfce7;
            color: #16a34a;
        }

        .match-status.unmatched {
            background: #fef3c7;
            color: #92400e;
        }

        .match-dropdown {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            max-width: 300px;
        }

        .match-dropdown:focus {
            outline: none;
            border-color: #4a7c2c;
        }

        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a7c2c 0%, #16a34a 100%);
            transition: width 0.3s ease;
        }

        .format-guide {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .format-guide h3 {
            color: #1e40af;
            margin-bottom: 15px;
            font-size: 1.125rem;
        }

        .format-guide ul {
            list-style: none;
            padding: 0;
        }

        .format-guide li {
            padding: 8px 0;
            color: #1e40af;
        }

        .format-guide li::before {
            content: "‚úì ";
            color: #16a34a;
            font-weight: bold;
            margin-right: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            justify-content: flex-end;
        }

        .template-section {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .template-section h3 {
            color: #92400e;
            margin-bottom: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #4a7c2c;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .price-input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            width: 120px;
            text-align: right;
        }

        .price-input:focus {
            outline: none;
            border-color: #4a7c2c;
        }

        .confidence-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .confidence-high {
            background: #dcfce7;
            color: #16a34a;
        }

        .confidence-medium {
            background: #fef3c7;
            color: #92400e;
        }

        .confidence-low {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <!-- Header placeholder - will be injected by header-user-display.js -->
    <header class="iterum-header">
        <div class="header-container">
            <a href="index.html" class="header-logo">
                <div class="header-logo-icon">üçÉ</div>
                <div class="header-logo-text">
                    <div class="header-logo-title">Iterum R&D</div>
                    <div class="header-logo-subtitle">Chef Notebook</div>
                </div>
            </a>
            
            <nav class="header-navigation">
                <a href="index.html" class="header-nav-item">üè† Dashboard</a>
                <a href="ingredients.html" class="header-nav-item">ü•¨ Ingredients</a>
                <a href="vendor-management.html" class="header-nav-item">üè™ Vendors</a>
                <a href="price-list-upload.html" class="header-nav-item active">üí∞ Price Lists</a>
            </nav>

            <div class="header-user-section">
                <div class="header-user-tab" id="header-user-tab" style="display: none;">
                    <div class="header-user-avatar"><span id="user-avatar-initial">üë§</span></div>
                    <div class="header-user-info">
                        <div class="header-user-name" id="current-user">Loading...</div>
                        <div class="header-user-role">Chef</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>üí∞ Price List Upload & Matching</h1>
            <p>Upload vendor price lists and automatically match with your inventory and ingredients</p>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <h2 style="margin-bottom: 20px; color: #1e293b;">Upload Price List</h2>
            
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">üìÑ</div>
                <div class="upload-title">Drag & Drop or Click to Upload</div>
                <div class="upload-subtitle">Supports CSV, Excel (.xlsx, .xls), and text files</div>
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    <span>üìÅ</span>
                    <span>Choose File</span>
                </button>
                <input type="file" id="fileInput" class="file-input" accept=".csv,.xlsx,.xls,.txt" onchange="handleFileSelect(event)">
            </div>

            <div class="format-guide">
                <h3>üìã Supported Format</h3>
                <ul>
                    <li>Columns: Item Name, SKU/Code, Unit Size, Unit, Price</li>
                    <li>Additional columns: Description, Category, Brand</li>
                    <li>Example: "Chicken Breast, CHK-001, 5, lb, 12.99"</li>
                    <li>Header row optional but recommended</li>
                </ul>
            </div>

            <div class="template-section">
                <h3>üì• Download Template</h3>
                <p style="margin-bottom: 15px; color: #92400e;">Not sure about the format? Download our template:</p>
                <button class="btn btn-secondary" onclick="downloadTemplate()">
                    <span>üì•</span>
                    <span>Download CSV Template</span>
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <p style="color: #64748b; font-weight: 600;">Processing price list and matching items...</p>
        </div>

        <!-- Matching Section -->
        <div class="matching-section" id="matchingSection">
            <h2 style="margin-bottom: 20px; color: #1e293b;">Review Matches</h2>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <div class="match-stats">
                <div class="stat-card matched">
                    <div class="stat-number" id="matchedCount">0</div>
                    <div class="stat-label">Automatically Matched</div>
                </div>
                <div class="stat-card unmatched">
                    <div class="stat-number" id="unmatchedCount">0</div>
                    <div class="stat-label">Needs Review</div>
                </div>
                <div class="stat-card total">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">Total Items</div>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <button class="btn btn-secondary" onclick="showMatched()">
                    <span>‚úì</span>
                    <span>Show Matched</span>
                </button>
                <button class="btn btn-secondary" onclick="showUnmatched()">
                    <span>‚ö†Ô∏è</span>
                    <span>Show Unmatched</span>
                </button>
                <button class="btn btn-secondary" onclick="showAll()">
                    <span>üìã</span>
                    <span>Show All</span>
                </button>
            </div>

            <table class="match-table">
                <thead>
                    <tr>
                        <th>Price List Item</th>
                        <th>SKU/Code</th>
                        <th>Size</th>
                        <th>Price</th>
                        <th>Match Status</th>
                        <th>Matched Ingredient</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="matchTableBody">
                    <!-- Rows will be populated by JavaScript -->
                </tbody>
            </table>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="cancelImport()">
                    <span>‚úï</span>
                    <span>Cancel</span>
                </button>
                <button class="btn btn-primary" onclick="saveMatches()">
                    <span>‚úì</span>
                    <span>Save & Import Prices</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let priceListData = [];
        let ingredientsDatabase = [];
        let currentFilter = 'all'; // 'all', 'matched', 'unmatched'

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üí∞ Price List Upload page loaded');
            loadIngredientsDatabase();
            setupDragAndDrop();
        });

        // Load ingredients from localStorage (or API)
        function loadIngredientsDatabase() {
            const savedIngredients = localStorage.getItem('ingredients_database');
            if (savedIngredients) {
                ingredientsDatabase = JSON.parse(savedIngredients);
                console.log('‚úÖ Loaded ' + ingredientsDatabase.length + ' ingredients from database');
            } else {
                // Sample data if none exists
                ingredientsDatabase = [
                    { id: 1, name: 'Chicken Breast', category: 'Protein', unit: 'lb' },
                    { id: 2, name: 'Olive Oil', category: 'Oil', unit: 'gal' },
                    { id: 3, name: 'Tomatoes', category: 'Produce', unit: 'lb' },
                    { id: 4, name: 'Flour', category: 'Dry Goods', unit: 'lb' },
                    { id: 5, name: 'Salt', category: 'Seasoning', unit: 'lb' }
                ];
                console.log('‚ÑπÔ∏è Using sample ingredients database');
            }
        }

        // Drag and drop setup
        function setupDragAndDrop() {
            const zone = document.getElementById('uploadZone');
            
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('dragover');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('dragover');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        // Handle file selection
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        // Process uploaded file
        function handleFile(file) {
            console.log('üìÑ Processing file:', file.name);
            
            // Show loading
            document.getElementById('loadingState').classList.add('active');
            document.querySelector('.upload-section').style.display = 'none';

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                
                setTimeout(() => {
                    if (file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                        parseCSV(content);
                    } else {
                        // For Excel files, we'd need a library like SheetJS
                        alert('Excel support coming soon! Please use CSV for now.');
                        resetUpload();
                    }
                }, 1000);
            };

            if (file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                reader.readAsText(file);
            } else {
                reader.readAsBinaryString(file);
            }
        }

        // Parse CSV content
        function parseCSV(content) {
            const lines = content.split('\n').filter(line => line.trim());
            const data = [];

            // Skip header row if it exists
            const startIndex = lines[0].toLowerCase().includes('item') || lines[0].toLowerCase().includes('name') ? 1 : 0;

            for (let i = startIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Parse CSV (handle quoted fields)
                const fields = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                const cleanFields = fields.map(f => f.replace(/^"|"$/g, '').trim());

                if (cleanFields.length >= 3) {
                    const item = {
                        itemName: cleanFields[0] || '',
                        sku: cleanFields[1] || '',
                        unitSize: cleanFields[2] || '',
                        unit: cleanFields[3] || 'ea',
                        price: parseFloat(cleanFields[4]) || 0,
                        matched: false,
                        matchedIngredient: null,
                        confidence: 0
                    };

                    // Try to auto-match
                    const match = findBestMatch(item.itemName);
                    if (match) {
                        item.matched = true;
                        item.matchedIngredient = match.ingredient;
                        item.confidence = match.confidence;
                    }

                    data.push(item);
                }
            }

            priceListData = data;
            console.log('‚úÖ Parsed ' + data.length + ' items');
            showMatches();
        }

        // Find best matching ingredient
        function findBestMatch(itemName) {
            if (!itemName) return null;

            const searchTerm = itemName.toLowerCase();
            let bestMatch = null;
            let bestScore = 0;

            for (const ingredient of ingredientsDatabase) {
                const ingredientName = ingredient.name.toLowerCase();
                let score = 0;

                // Exact match
                if (ingredientName === searchTerm) {
                    score = 100;
                }
                // Contains full search term
                else if (ingredientName.includes(searchTerm)) {
                    score = 80;
                }
                // Search term contains ingredient name
                else if (searchTerm.includes(ingredientName)) {
                    score = 70;
                }
                // Word-by-word matching
                else {
                    const searchWords = searchTerm.split(/\s+/);
                    const ingredientWords = ingredientName.split(/\s+/);
                    let matchedWords = 0;

                    for (const word of searchWords) {
                        if (ingredientWords.some(iw => iw.includes(word) || word.includes(iw))) {
                            matchedWords++;
                        }
                    }

                    score = (matchedWords / Math.max(searchWords.length, ingredientWords.length)) * 60;
                }

                if (score > bestScore && score > 50) { // Minimum 50% confidence
                    bestScore = score;
                    bestMatch = ingredient;
                }
            }

            if (bestMatch) {
                return {
                    ingredient: bestMatch,
                    confidence: Math.round(bestScore)
                };
            }

            return null;
        }

        // Show matching results
        function showMatches() {
            document.getElementById('loadingState').classList.remove('active');
            document.getElementById('matchingSection').classList.add('active');

            const matched = priceListData.filter(item => item.matched).length;
            const total = priceListData.length;
            const progress = total > 0 ? (matched / total * 100) : 0;

            document.getElementById('matchedCount').textContent = matched;
            document.getElementById('unmatchedCount').textContent = total - matched;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('progressFill').style.width = progress + '%';

            renderTable();
        }

        // Render table rows
        function renderTable() {
            const tbody = document.getElementById('matchTableBody');
            tbody.innerHTML = '';

            const filteredData = priceListData.filter(item => {
                if (currentFilter === 'matched') return item.matched;
                if (currentFilter === 'unmatched') return !item.matched;
                return true;
            });

            filteredData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const statusBadge = item.matched
                    ? `<span class="match-status matched">‚úì Matched</span>`
                    : `<span class="match-status unmatched">‚ö†Ô∏è Unmatched</span>`;

                const confidenceBadge = item.matched
                    ? `<span class="confidence-badge ${getConfidenceClass(item.confidence)}">${item.confidence}%</span>`
                    : '';

                const matchedIngredient = item.matchedIngredient
                    ? `${item.matchedIngredient.name} ${confidenceBadge}`
                    : 'No match found';

                const ingredientOptions = createIngredientDropdown(item, index);

                row.innerHTML = `
                    <td><strong>${item.itemName}</strong></td>
                    <td>${item.sku}</td>
                    <td>${item.unitSize} ${item.unit}</td>
                    <td>$<input type="number" step="0.01" class="price-input" value="${item.price.toFixed(2)}" onchange="updatePrice(${index}, this.value)"></td>
                    <td>${statusBadge}</td>
                    <td>${matchedIngredient}</td>
                    <td>
                        <select class="match-dropdown" onchange="changeMatch(${index}, this.value)">
                            ${ingredientOptions}
                        </select>
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        // Create ingredient dropdown
        function createIngredientDropdown(item, index) {
            let options = '<option value="">-- Select Ingredient --</option>';
            
            ingredientsDatabase.forEach(ingredient => {
                const selected = item.matchedIngredient && item.matchedIngredient.id === ingredient.id ? 'selected' : '';
                options += `<option value="${ingredient.id}" ${selected}>${ingredient.name} (${ingredient.category})</option>`;
            });

            return options;
        }

        // Get confidence class
        function getConfidenceClass(confidence) {
            if (confidence >= 80) return 'confidence-high';
            if (confidence >= 60) return 'confidence-medium';
            return 'confidence-low';
        }

        // Change match
        function changeMatch(index, ingredientId) {
            if (ingredientId) {
                const ingredient = ingredientsDatabase.find(ing => ing.id == ingredientId);
                priceListData[index].matched = true;
                priceListData[index].matchedIngredient = ingredient;
                priceListData[index].confidence = 100; // Manual match = 100%
            } else {
                priceListData[index].matched = false;
                priceListData[index].matchedIngredient = null;
                priceListData[index].confidence = 0;
            }
            showMatches();
        }

        // Update price
        function updatePrice(index, newPrice) {
            priceListData[index].price = parseFloat(newPrice) || 0;
        }

        // Filter functions
        function showMatched() {
            currentFilter = 'matched';
            renderTable();
        }

        function showUnmatched() {
            currentFilter = 'unmatched';
            renderTable();
        }

        function showAll() {
            currentFilter = 'all';
            renderTable();
        }

        // Save matches
        function saveMatches() {
            const matchedItems = priceListData.filter(item => item.matched);
            
            if (matchedItems.length === 0) {
                alert('‚ö†Ô∏è No matches to save! Please match at least one item.');
                return;
            }

            if (confirm(`Save ${matchedItems.length} price updates to your ingredients?`)) {
                // Save to localStorage (or send to API)
                const priceUpdates = matchedItems.map(item => ({
                    ingredientId: item.matchedIngredient.id,
                    ingredientName: item.matchedIngredient.name,
                    vendorItem: item.itemName,
                    sku: item.sku,
                    unitSize: item.unitSize,
                    unit: item.unit,
                    price: item.price,
                    updatedAt: new Date().toISOString()
                }));

                const existingPrices = JSON.parse(localStorage.getItem('price_history') || '[]');
                existingPrices.push(...priceUpdates);
                localStorage.setItem('price_history', JSON.stringify(existingPrices));

                // Track analytics
                if (window.analyticsTracker) {
                    window.analyticsTracker.trackCustomEvent('price_list_imported', {
                        items_matched: matchedItems.length,
                        items_total: priceListData.length
                    });
                }

                alert(`‚úÖ Successfully imported ${matchedItems.length} price updates!`);
                resetUpload();
            }
        }

        // Cancel import
        function cancelImport() {
            if (confirm('Discard this price list?')) {
                resetUpload();
            }
        }

        // Reset upload
        function resetUpload() {
            priceListData = [];
            document.getElementById('matchingSection').classList.remove('active');
            document.getElementById('loadingState').classList.remove('active');
            document.querySelector('.upload-section').style.display = 'block';
            document.getElementById('fileInput').value = '';
        }

        // Download template
        function downloadTemplate() {
            const template = `Item Name,SKU/Code,Unit Size,Unit,Price
Chicken Breast Boneless,CHK-001,5,lb,12.99
Olive Oil Extra Virgin,OIL-002,1,gal,24.50
Roma Tomatoes,PRD-003,25,lb,18.75
All Purpose Flour,DRY-004,50,lb,22.00
Sea Salt Fine,SZN-005,5,lb,8.99
`;

            const blob = new Blob([template], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'price-list-template.csv';
            a.click();
            URL.revokeObjectURL(url);

            // Track analytics
            if (window.analyticsTracker) {
                window.analyticsTracker.trackCustomEvent('template_downloaded', {
                    template_type: 'price_list'
                });
            }
        }
    </script>
</body>
</html>

