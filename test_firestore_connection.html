<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firestore Connection</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 600;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        .info {
            background: #f0f9ff;
            color: #0369a1;
            border: 2px solid #0ea5e9;
        }
        button {
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin: 8px;
        }
        button:hover {
            background: #2563eb;
        }
        pre {
            background: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üî• Firestore Connection Test</h1>
    
    <div id="status" class="status info">
        Testing Firestore connection...
    </div>
    
    <div id="details"></div>
    
    <div>
        <button onclick="testConnection()">üîÑ Test Connection</button>
        <button onclick="testWrite()">üíæ Test Write</button>
        <button onclick="testRead()">üìñ Test Read</button>
        <button onclick="enableFirestore()">üî• Enable Firestore</button>
    </div>

    <!-- Load Firebase -->
    <script src="assets/js/firebase-config.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc,
            collection,
            getDocs
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        let app, db;

        async function init() {
            const statusDiv = document.getElementById('status');
            const detailsDiv = document.getElementById('details');
            
            try {
                // Initialize Firebase
                app = initializeApp(window.firebaseConfig);
                console.log('‚úÖ Firebase initialized');
                
                // Try to initialize Firestore
                db = getFirestore(app);
                console.log('‚úÖ Firestore instance created');
                
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ Firestore is ENABLED and ready to use!';
                
                detailsDiv.innerHTML = `
                    <pre>
Firebase Project: ${window.firebaseConfig.projectId}
Firestore Status: ENABLED ‚úÖ
Database Location: Check Firebase Console

Next Steps:
1. Click "Test Write" to save test data
2. Check Firebase Console to see the data
3. Your app can now use Firestore!
                    </pre>
                `;
                
                window.firestoreDB = db;
                
            } catch (error) {
                console.error('‚ùå Firestore error:', error);
                
                if (error.code === 'failed-precondition' || error.message.includes('not exist')) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå Firestore NOT ENABLED in Firebase Console';
                    
                    detailsDiv.innerHTML = `
                        <pre>
Error: ${error.message}

Firestore Status: NOT ENABLED ‚ùå

To enable Firestore:
1. Go to: https://console.firebase.google.com/project/iterum-culinary-app/firestore
2. Click: "Create Database"
3. Select: "Production mode"
4. Choose: Location (us-central1)
5. Click: "Enable"
6. Wait 1-2 minutes
7. Reload this page
                        </pre>
                    `;
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå Error: ' + error.message;
                    detailsDiv.innerHTML = `<pre>${error.stack}</pre>`;
                }
            }
        }

        window.testConnection = async function() {
            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status info';
            statusDiv.textContent = 'Testing connection...';
            
            await init();
        };

        window.testWrite = async function() {
            const statusDiv = document.getElementById('status');
            
            if (!db) {
                alert('Firestore not initialized. Click "Test Connection" first.');
                return;
            }
            
            try {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'Writing test data...';
                
                const testData = {
                    testField: 'Hello Firestore!',
                    timestamp: new Date().toISOString(),
                    from: 'Iterum App'
                };
                
                await setDoc(doc(db, 'test', 'connection_test'), testData);
                
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ Test data written successfully! Check Firebase Console.';
                
                console.log('‚úÖ Data written to Firestore');
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Write failed: ' + error.message;
                console.error(error);
            }
        };

        window.testRead = async function() {
            const statusDiv = document.getElementById('status');
            
            if (!db) {
                alert('Firestore not initialized. Click "Test Connection" first.');
                return;
            }
            
            try {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'Reading test data...';
                
                const docRef = doc(db, 'test', 'connection_test');
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ Test data read successfully!';
                    
                    document.getElementById('details').innerHTML = `
                        <h3>Data from Firestore:</h3>
                        <pre>${JSON.stringify(docSnap.data(), null, 2)}</pre>
                    `;
                } else {
                    statusDiv.className = 'status info';
                    statusDiv.textContent = '‚ÑπÔ∏è No test data found. Click "Test Write" first.';
                }
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Read failed: ' + error.message;
                console.error(error);
            }
        };

        window.enableFirestore = function() {
            window.open('https://console.firebase.google.com/project/iterum-culinary-app/firestore', '_blank');
        };

        // Auto-test on load
        init();
    </script>
</body>
</html>

