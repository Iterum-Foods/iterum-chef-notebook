<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef's Dashboard - Iterum</title>
    
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/auth-manager.js"></script>
    <script src="assets/js/unified-nav-header.js" defer></script>
    <script src="assets/js/unified-project-selector.js" defer></script>
    <script src="assets/js/user-data-manager.js" defer></script>
    <script src="assets/js/cloud-data-sync.js" defer></script>
    
    <link rel="stylesheet" href="assets/css/unified-cards.css">
    <link rel="stylesheet" href="assets/css/high-contrast-universal.css">
    <link rel="stylesheet" href="assets/css/nordic-design-system.css">
    
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            padding: 90px 0 80px 0;
            margin: 0;
        }
        
        .chef-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Quick Access Grid - Large Touch Targets */
        .quick-access-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quick-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 25px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: 10px;
        }
        
        .quick-btn:active {
            transform: scale(0.95);
        }
        
        .quick-btn-icon {
            font-size: 2.5rem;
        }
        
        /* Floating Quick Note Button */
        .floating-note-btn {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.4);
            z-index: 9997;
            transition: all 0.3s ease;
        }
        
        .floating-note-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(245, 158, 11, 0.6);
        }
        
        /* Quick Note Capture */
        .quick-note-popup {
            position: fixed;
            bottom: 180px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            padding: 20px;
            z-index: 9998;
            display: none;
        }
        
        .quick-note-popup.show {
            display: block;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Today's Prep List */
        .prep-list {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .prep-item {
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .prep-item:hover {
            background: #f1f5f9;
            transform: translateX(5px);
        }
        
        .prep-checkbox {
            width: 24px;
            height: 24px;
            border: 3px solid #cbd5e1;
            border-radius: 6px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .prep-checkbox.checked {
            background: #10b981;
            border-color: #10b981;
            position: relative;
        }
        
        .prep-checkbox.checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 700;
            font-size: 16px;
        }
        
        /* Quick Stats Cards */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card-mini {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        .stat-number-mini {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label-mini {
            color: #64748b;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 5px;
        }
        
        /* Mobile Optimized */
        @media (max-width: 768px) {
            body {
                padding: 80px 0 100px 0;
            }
            
            .quick-access-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-note-popup {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="assets/css/iterum-brand-kit.css">
    <link rel="stylesheet" href="assets/css/header-universal.css">
    <link rel="stylesheet" href="assets/css/modern-nordic-vintage.css">
    <link rel="stylesheet" href="assets/css/dark-mode-enhancements.css">
</head>
<body style="padding-top: 80px;">
    <div class="chef-container">
        <!-- Date & Time Header -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 16px; margin-bottom: 25px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">üë®‚Äçüç≥ Chef's Dashboard</h1>
                    <p style="opacity: 0.9;" id="current-date-time">Loading...</p>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 3rem; font-weight: 700;" id="current-time">00:00</div>
                    <div style="opacity: 0.9; font-size: 0.9rem;" id="service-countdown">Service in X hours</div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="stats-row">
            <div class="stat-card-mini">
                <div class="stat-number-mini" id="prep-items-left">0</div>
                <div class="stat-label-mini">Prep Items Left</div>
            </div>
            <div class="stat-card-mini">
                <div class="stat-number-mini" id="recipes-count">0</div>
                <div class="stat-label-mini">Active Recipes</div>
            </div>
            <div class="stat-card-mini">
                <div class="stat-number-mini" id="notes-today">0</div>
                <div class="stat-label-mini">Notes Today</div>
            </div>
            <div class="stat-card-mini">
                <div class="stat-number-mini" id="equipment-issues">0</div>
                <div class="stat-label-mini">Equipment Issues</div>
            </div>
        </div>

        <!-- Quick Access Actions -->
        <h2 style="font-size: 1.3rem; font-weight: 700; margin-bottom: 15px; color: #1e293b;">‚ö° Quick Access</h2>
        <div class="quick-access-grid">
            <button class="quick-btn" onclick="quickNote('kitchen')" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                <div class="quick-btn-icon">üìù</div>
                <div>Kitchen Note</div>
            </button>
            <button class="quick-btn" onclick="viewPrepList()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <div class="quick-btn-icon">üìã</div>
                <div>Today's Prep</div>
            </button>
            <button class="quick-btn" onclick="quickNote('equipment')" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                <div class="quick-btn-icon">üîß</div>
                <div>Equipment Issue</div>
            </button>
            <button class="quick-btn" onclick="quickNote('vendor')" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <div class="quick-btn-icon">üè™</div>
                <div>Vendor Note</div>
            </button>
            <button class="quick-btn" onclick="location.href='recipe-developer.html'" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);">
                <div class="quick-btn-icon">üß™</div>
                <div>New Recipe</div>
            </button>
            <button class="quick-btn" onclick="location.href='kitchen-management.html?tab=checklist'" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <div class="quick-btn-icon">‚úÖ</div>
                <div>Quality Check</div>
            </button>
        </div>

        <!-- Today's Prep List -->
        <div class="prep-list" style="margin-bottom: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 1.3rem; font-weight: 700; color: #1e293b; margin: 0;">üìã Today's Prep List</h2>
                <button onclick="addPrepItem()" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    ‚ûï Add Item
                </button>
            </div>
            <div id="prep-list-container">
                <!-- Prep items will be added here -->
            </div>
        </div>

        <!-- Recent Notes -->
        <div style="background: white; border-radius: 16px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 1.3rem; font-weight: 700; color: #1e293b; margin: 0;">üí¨ Recent Notes</h2>
                <button onclick="viewAllNotes()" style="background: transparent; color: #667eea; border: none; font-weight: 600; cursor: pointer;">
                    View All ‚Üí
                </button>
            </div>
            <div id="recent-notes-container">
                <!-- Recent notes will be added here -->
            </div>
        </div>
    </div>

    <!-- Floating Quick Note Button -->
    <button class="floating-note-btn" onclick="toggleQuickNote()" title="Quick Note">
        üìù
    </button>

    <!-- Quick Note Popup -->
    <div class="quick-note-popup" id="quick-note-popup">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="font-weight: 700; margin: 0;">‚úçÔ∏è Quick Note</h3>
            <button onclick="toggleQuickNote()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úï</button>
        </div>
        
        <select id="note-type" onchange="handleNoteTypeChange()" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; font-size: 1rem;">
            <option value="kitchen">üî™ Kitchen</option>
            <option value="equipment">üîß Equipment</option>
            <option value="vendor">üè™ Vendor</option>
            <option value="prep">üìã Prep</option>
            <option value="recipe">üß™ Recipe Idea</option>
            <option value="service">üçΩÔ∏è Service</option>
        </select>
        
        <!-- Vendor Selector (shows when vendor type is selected) -->
        <div id="vendor-selector" style="display: none; margin-bottom: 10px;">
            <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #1e293b;">Select Vendor:</label>
            <select id="vendor-select" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                <option value="">-- Select Vendor --</option>
            </select>
        </div>
        
        <!-- Equipment Selector (shows when equipment type is selected) -->
        <div id="equipment-selector" style="display: none; margin-bottom: 10px;">
            <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #1e293b;">Select Equipment:</label>
            <select id="equipment-select" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                <option value="">-- Select Equipment --</option>
            </select>
        </div>
        
        <textarea id="quick-note-text" placeholder="Type your note here..." style="width: 100%; min-height: 120px; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; resize: vertical; font-family: inherit; margin-bottom: 10px;"></textarea>
        
        <!-- Photo Upload -->
        <div style="margin-bottom: 10px;">
            <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #1e293b;">üì∏ Add Photo (Optional):</label>
            <input type="file" id="note-photo" accept="image/*" capture="environment" style="display: none;" onchange="handlePhotoUpload(event)">
            <button onclick="document.getElementById('note-photo').click()" style="width: 100%; padding: 12px; background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 8px; color: #64748b; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                üì∑ Take/Upload Photo
            </button>
            <div id="photo-preview" style="margin-top: 10px; display: none;">
                <img id="photo-preview-img" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb;">
                <button onclick="removePhoto()" style="margin-top: 5px; width: 100%; padding: 8px; background: #fee2e2; color: #dc2626; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                    üóëÔ∏è Remove Photo
                </button>
            </div>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button onclick="saveQuickNote()" style="flex: 1; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                üíæ Save
            </button>
            <button onclick="voiceNote()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                üé§
            </button>
        </div>
    </div>

    <script>
        let prepList = [];
        let quickNotes = [];
        let currentPhoto = null; // Store current photo data

        // Update time every second
        function updateDateTime() {
            const now = new Date();
            
            // Current time
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Current date
            document.getElementById('current-date-time').textContent = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Service countdown (assuming 5:30 PM service)
            const serviceTime = new Date();
            serviceTime.setHours(17, 30, 0);
            if (now > serviceTime) {
                serviceTime.setDate(serviceTime.getDate() + 1);
            }
            const hoursUntil = ((serviceTime - now) / (1000 * 60 * 60)).toFixed(1);
            document.getElementById('service-countdown').textContent = `Service in ${hoursUntil} hours`;
        }
        
        setInterval(updateDateTime, 1000);
        updateDateTime();

        // Toggle quick note popup
        function toggleQuickNote() {
            const popup = document.getElementById('quick-note-popup');
            popup.classList.toggle('show');
            
            if (popup.classList.contains('show')) {
                document.getElementById('quick-note-text').focus();
            }
        }

        // Quick note with pre-selected type
        function quickNote(type) {
            const popup = document.getElementById('quick-note-popup');
            popup.classList.add('show');
            document.getElementById('note-type').value = type;
            document.getElementById('quick-note-text').focus();
        }

        // Handle note type change
        function handleNoteTypeChange() {
            const type = document.getElementById('note-type').value;
            const vendorSelector = document.getElementById('vendor-selector');
            const equipmentSelector = document.getElementById('equipment-selector');
            
            // Show/hide vendor selector
            if (type === 'vendor') {
                vendorSelector.style.display = 'block';
                loadVendorsIntoSelect();
            } else {
                vendorSelector.style.display = 'none';
            }
            
            // Show/hide equipment selector
            if (type === 'equipment') {
                equipmentSelector.style.display = 'block';
                loadEquipmentIntoSelect();
            } else {
                equipmentSelector.style.display = 'none';
            }
        }

        // Load vendors into select
        function loadVendorsIntoSelect() {
            const select = document.getElementById('vendor-select');
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            
            // Try to get vendors from localStorage
            let vendors = [];
            const vendorsData = localStorage.getItem(`vendors_${userId}`);
            if (vendorsData) {
                try {
                    vendors = JSON.parse(vendorsData);
                } catch (e) {
                    console.error('Error parsing vendors:', e);
                }
            }
            
            // Clear existing options except first
            select.innerHTML = '<option value="">-- Select Vendor --</option>';
            
            // Add vendors
            if (vendors && vendors.length > 0) {
                vendors.forEach(vendor => {
                    const option = document.createElement('option');
                    option.value = vendor.id;
                    option.textContent = vendor.name;
                    select.appendChild(option);
                });
            }
        }

        // Load equipment into select
        function loadEquipmentIntoSelect() {
            const select = document.getElementById('equipment-select');
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            
            // Try to get equipment from localStorage
            let equipment = [];
            const equipmentData = localStorage.getItem(`equipment_${userId}`);
            if (equipmentData) {
                try {
                    equipment = JSON.parse(equipmentData);
                } catch (e) {
                    console.error('Error parsing equipment:', e);
                }
            }
            
            // Clear existing options except first
            select.innerHTML = '<option value="">-- Select Equipment --</option>';
            
            // Add equipment
            if (equipment && equipment.length > 0) {
                equipment.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.name;
                    select.appendChild(option);
                });
            }
        }

        // Handle photo upload
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Photo is too large. Please choose a photo under 5MB.');
                return;
            }
            
            // Read the file
            const reader = new FileReader();
            reader.onload = function(e) {
                currentPhoto = e.target.result;
                
                // Show preview
                document.getElementById('photo-preview-img').src = currentPhoto;
                document.getElementById('photo-preview').style.display = 'block';
                
                showToast('üì∏ Photo added!');
            };
            reader.readAsDataURL(file);
        }

        // Remove photo
        function removePhoto() {
            currentPhoto = null;
            document.getElementById('photo-preview').style.display = 'none';
            document.getElementById('note-photo').value = '';
            showToast('Photo removed');
        }

        // Save quick note
        function saveQuickNote() {
            const type = document.getElementById('note-type').value;
            const text = document.getElementById('quick-note-text').value.trim();
            
            if (!text) {
                alert('Please enter a note');
                return;
            }

            const note = {
                id: `note_${Date.now()}`,
                type,
                text,
                timestamp: new Date().toISOString(),
                userId: window.authManager?.currentUser?.userId,
                photo: currentPhoto // Include photo if added
            };
            
            // Add vendor info if vendor note
            if (type === 'vendor') {
                const vendorId = document.getElementById('vendor-select').value;
                const vendorName = document.getElementById('vendor-select').selectedOptions[0]?.textContent;
                if (vendorId) {
                    note.vendorId = vendorId;
                    note.vendorName = vendorName;
                    
                    // Also save to vendor's notes
                    saveNoteToVendor(vendorId, note);
                }
            }
            
            // Add equipment info if equipment note
            if (type === 'equipment') {
                const equipmentId = document.getElementById('equipment-select').value;
                const equipmentName = document.getElementById('equipment-select').selectedOptions[0]?.textContent;
                if (equipmentId) {
                    note.equipmentId = equipmentId;
                    note.equipmentName = equipmentName;
                    
                    // Also save to equipment's notes
                    saveNoteToEquipment(equipmentId, note);
                }
            }

            // Save to notes array
            quickNotes.unshift(note);
            
            // Save to localStorage
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            localStorage.setItem(`chef_notes_${userId}`, JSON.stringify(quickNotes));

            // Also save to daily notes if available
            saveToDailyNotes(type, text, note.photo, note.vendorName, note.equipmentName);

            // Clear form
            document.getElementById('quick-note-text').value = '';
            document.getElementById('vendor-select').value = '';
            document.getElementById('equipment-select').value = '';
            removePhoto();
            toggleQuickNote();

            // Update display
            displayRecentNotes();
            updateStats();

            // Show confirmation
            showToast('‚úÖ Note saved!');
        }

        // Save note to vendor
        function saveNoteToVendor(vendorId, note) {
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            
            // Get vendor notes
            const vendorNotesKey = `vendor_notes_${userId}_${vendorId}`;
            let vendorNotes = JSON.parse(localStorage.getItem(vendorNotesKey) || '[]');
            
            // Add note
            vendorNotes.unshift({
                id: note.id,
                text: note.text,
                timestamp: note.timestamp,
                photo: note.photo
            });
            
            // Save back
            localStorage.setItem(vendorNotesKey, JSON.stringify(vendorNotes));
            
            console.log(`üìù Note saved to vendor ${vendorId}`);
        }

        // Save note to equipment
        function saveNoteToEquipment(equipmentId, note) {
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            
            // Get equipment notes
            const equipmentNotesKey = `equipment_notes_${userId}_${equipmentId}`;
            let equipmentNotes = JSON.parse(localStorage.getItem(equipmentNotesKey) || '[]');
            
            // Add note
            equipmentNotes.unshift({
                id: note.id,
                text: note.text,
                timestamp: note.timestamp,
                photo: note.photo
            });
            
            // Save back
            localStorage.setItem(equipmentNotesKey, JSON.stringify(equipmentNotes));
            
            console.log(`üìù Note saved to equipment ${equipmentId}`);
        }

        // Voice note
        function voiceNote() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Voice input not supported on this browser. Please use Chrome or Edge.');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('quick-note-text').value = transcript;
                showToast('üé§ Voice captured!');
            };
            
            recognition.onerror = (event) => {
                showToast('‚ùå Voice input failed', 'error');
            };
            
            recognition.start();
            showToast('üé§ Listening...');
        }

        // Add prep item
        function addPrepItem() {
            const text = prompt('Prep item:');
            if (!text) return;

            const item = {
                id: `prep_${Date.now()}`,
                text,
                checked: false,
                addedAt: new Date().toISOString()
            };

            prepList.push(item);
            savePrepList();
            displayPrepList();
            updateStats();
        }

        // Toggle prep item
        function togglePrepItem(id) {
            const item = prepList.find(p => p.id === id);
            if (item) {
                item.checked = !item.checked;
                savePrepList();
                displayPrepList();
                updateStats();
            }
        }

        // Display prep list
        function displayPrepList() {
            const container = document.getElementById('prep-list-container');
            
            if (prepList.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #94a3b8;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">üìã</div>
                        <p>No prep items yet. Add your first item!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = prepList.map(item => `
                <div class="prep-item" onclick="togglePrepItem('${item.id}')">
                    <div class="prep-checkbox ${item.checked ? 'checked' : ''}"></div>
                    <div style="flex: 1; ${item.checked ? 'text-decoration: line-through; opacity: 0.5;' : ''}">${item.text}</div>
                    <button onclick="event.stopPropagation(); deletePrepItem('${item.id}')" style="background: #fee2e2; color: #dc2626; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">
                        üóëÔ∏è
                    </button>
                </div>
            `).join('');
        }

        // Delete prep item
        function deletePrepItem(id) {
            prepList = prepList.filter(p => p.id !== id);
            savePrepList();
            displayPrepList();
            updateStats();
        }

        // Save prep list
        function savePrepList() {
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            const today = new Date().toISOString().split('T')[0];
            localStorage.setItem(`prep_list_${userId}_${today}`, JSON.stringify(prepList));
        }

        // Load prep list
        function loadPrepList() {
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            const today = new Date().toISOString().split('T')[0];
            const stored = localStorage.getItem(`prep_list_${userId}_${today}`);
            
            if (stored) {
                prepList = JSON.parse(stored);
            } else {
                // Load default prep items
                prepList = [
                    { id: 'prep_1', text: 'Check mise en place', checked: false },
                    { id: 'prep_2', text: 'Review menu changes', checked: false },
                    { id: 'prep_3', text: 'Prep vegetables', checked: false },
                    { id: 'prep_4', text: 'Make stocks', checked: false }
                ];
                savePrepList();
            }
            
            displayPrepList();
        }

        // Display recent notes
        function displayRecentNotes() {
            const container = document.getElementById('recent-notes-container');
            
            if (quickNotes.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #94a3b8;">
                        <p>No notes yet. Use the üìù button to add one!</p>
                    </div>
                `;
                return;
            }

            const recent = quickNotes.slice(0, 5);
            container.innerHTML = recent.map(note => {
                const time = new Date(note.timestamp).toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const typeIcons = {
                    kitchen: 'üî™',
                    equipment: 'üîß',
                    vendor: 'üè™',
                    prep: 'üìã',
                    recipe: 'üß™',
                    service: 'üçΩÔ∏è'
                };
                
                // Build vendor/equipment tag
                let tagHtml = '';
                if (note.vendorName) {
                    tagHtml = `<div style="display: inline-block; background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; margin-top: 5px;">üè™ ${note.vendorName}</div>`;
                } else if (note.equipmentName) {
                    tagHtml = `<div style="display: inline-block; background: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; margin-top: 5px;">üîß ${note.equipmentName}</div>`;
                }
                
                // Build photo HTML
                let photoHtml = '';
                if (note.photo) {
                    photoHtml = `<img src="${note.photo}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-top: 8px; cursor: pointer;" onclick="viewNotePhoto('${note.id}')">`;
                }
                
                return `
                    <div style="padding: 12px; background: #f8fafc; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #667eea;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 5px;">
                            <span style="font-weight: 600; color: #1e293b;">${typeIcons[note.type]} ${note.type.charAt(0).toUpperCase() + note.type.slice(1)}</span>
                            <span style="font-size: 0.85rem; color: #94a3b8;">${time}</span>
                        </div>
                        <p style="color: #64748b; margin: 0; font-size: 0.95rem;">${note.text}</p>
                        ${tagHtml}
                        ${photoHtml}
                    </div>
                `;
            }).join('');
        }

        // View note photo in full size
        function viewNotePhoto(noteId) {
            const note = quickNotes.find(n => n.id === noteId);
            if (!note || !note.photo) return;
            
            // Create modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 99999;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 90vw; max-height: 90vh; position: relative;">
                    <img src="${note.photo}" style="max-width: 100%; max-height: 90vh; border-radius: 8px;">
                    <button onclick="this.parentElement.parentElement.remove()" style="position: absolute; top: 10px; right: 10px; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">‚úï</button>
                </div>
            `;
            
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            document.body.appendChild(modal);
        }

        // Load notes
        function loadNotes() {
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            const stored = localStorage.getItem(`chef_notes_${userId}`);
            
            if (stored) {
                quickNotes = JSON.parse(stored);
            }
            
            displayRecentNotes();
        }

        // Save to daily notes
        function saveToDailyNotes(type, text, photo, vendorName, equipmentName) {
            const today = new Date().toISOString().split('T')[0];
            const user = window.authManager?.currentUser;
            const userId = user?.userId || user?.id;
            
            const dailyNotesKey = `daily_notes_${userId}_${today}`;
            let dailyNotes = JSON.parse(localStorage.getItem(dailyNotesKey) || '{}');
            
            if (!dailyNotes[type]) {
                dailyNotes[type] = [];
            }
            
            dailyNotes[type].push({
                text,
                timestamp: new Date().toISOString(),
                photo,
                vendorName,
                equipmentName
            });
            
            localStorage.setItem(dailyNotesKey, JSON.stringify(dailyNotes));
        }

        // Update stats
        function updateStats() {
            // Prep items left
            const prepLeft = prepList.filter(p => !p.checked).length;
            document.getElementById('prep-items-left').textContent = prepLeft;

            // Notes today
            const today = new Date().toISOString().split('T')[0];
            const todayNotes = quickNotes.filter(n => n.timestamp.startsWith(today));
            document.getElementById('notes-today').textContent = todayNotes.length;

            // Equipment issues
            const equipmentNotes = quickNotes.filter(n => n.type === 'equipment' && !n.resolved);
            document.getElementById('equipment-issues').textContent = equipmentNotes.length;

            // Recipes count
            if (window.userDataManager) {
                const recipes = window.userDataManager.loadData('recipes');
                document.getElementById('recipes-count').textContent = recipes.length;
            }
        }

        // View prep list
        function viewPrepList() {
            location.href = 'kitchen-management.html?tab=preplist';
        }

        // View all notes
        function viewAllNotes() {
            location.href = 'audit-log.html';
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6';
            
            toast.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: ${bgColor};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                z-index: 99999;
                animation: slideDown 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // Initialize
        async function init() {
            console.log('üë®‚Äçüç≥ Initializing Chef Dashboard...');
            
            // Wait for auth
            await waitForAuth();
            
            // Load data
            loadPrepList();
            loadNotes();
            updateStats();
            
            console.log('‚úÖ Chef Dashboard ready');
        }

        async function waitForAuth() {
            return new Promise((resolve) => {
                const check = () => {
                    if (window.authManager?.currentUser) {
                        resolve();
                    } else {
                        setTimeout(check, 200);
                    }
                };
                check();
            });
        }

        // CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translate(-50%, -20px); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
            @keyframes slideUp {
                from { transform: translate(-50%, 0); opacity: 1; }
                to { transform: translate(-50%, -20px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize when ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Close popup when clicking outside
        document.addEventListener('click', (e) => {
            const popup = document.getElementById('quick-note-popup');
            const floatingBtn = document.querySelector('.floating-note-btn');
            
            if (popup.classList.contains('show') && 
                !popup.contains(e.target) && 
                !floatingBtn.contains(e.target)) {
                popup.classList.remove('show');
            }
        });
    </script>
</body>
</html>

